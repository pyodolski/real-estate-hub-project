![use case diagram](<./img/use case diagram.png>)<br>

이 Use Case Diagram은 부동산 통합 플랫폼(Real Estate Hub System)의 주요 기능과 외부 액터 간 상호작용을 시각화한 것이다.
본 시스템은 일반 사용자(User), 매물 소유자(Owner), 브로커(Broker), 관리자(Admin), 시스템/엔진(System), 지도 서비스(Map Service)의 여섯 주체가 상호 연계되어 작동한다.
전체 기능은 회원 인증, 매물 등록 및 검증, 지도 기반 매물 탐색, 대리중개(위임), 채팅/알림, 가격 분석 및 추천 등으로 구성된다.

주요 액터 설명 <br>
User (사용자) 일반 이용자. 매물 검색, 필터 적용, 지도 탐색, 즐겨찾기, 채팅, 평점 등록 등의 기능을 수행한다. <br>
Owner (소유자) 자신의 부동산을 시스템에 등록하고, 서류 업로드 및 중개 위임 요청 등을 수행한다. <br>
Broker (브로커) 소유자로부터 받은 위임을 관리하고, 매물 거래를 중개하며 평가를 받는다. <br>
Admin (관리자) 시스템 전반의 데이터 검수, 매물 신청 검토, 승인·거절 처리 등을 담당한다. <br>
System / Engine (시스템/엔진) 자동 추천, 가격 예측, 이상거래 탐지 등 백엔드 AI 및 데이터 분석 모듈을 의미한다. <br>
Map Service (지도 서비스) 외부 지도 API (예: Naver Map, Kakao Map)로부터 위치, POI, 인구 통계 데이터를 제공한다. <br>

# Use case 1. 매물 등록 신청

## 1.1 GENERAL CHARACTERISTICS

1.1.1 Summary : 사용자가 매물 소유권 증명을 위한 신청서를 상세정보와 필수 서류와 함께 제출하는 기능

1.1.2 Scope : None

1.1.3 Level : user level

1.1.4 Author : None

1.1.5 Last Update : None

1.1.6 Status : Implemented

1.1.7 Primary Actor : User

1.1.8 Preconditions

- 사용자가 로그인되어 있어야 함 (JWT 토큰 보유)
- `/api/ownership/**` 엔드포인트는 인증된 사용자만 접근 가능

  1.1.9 Trigger

- 사용자가 매물 소유권 신청 폼에서 "신청하기" 버튼을 클릭했을 때

  1.1.10 Success Post Conditions

- 매물 소유권 신청이 데이터베이스에 저장됨 (Status: PENDING)
- 업로드된 서류 파일들이 서버 저장소(`uploads/ownership/`)에 저장됨
- 고유한 파일명(타임스탬프 + UUID)으로 파일 저장
- 신청 ID가 포함된 응답 반환
- 관리자에게 검토 대기 상태로 전달됨

  1.1.11 Failure Post Conditions

- 신청 데이터가 저장되지 않음
- 업로드된 파일들이 저장되지 않음
- 사용자에게 오류 메시지 반환

## 1.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                                                  |
| ---- | ----------------------------------------------------------------------------------------------------------------------- |
| S    | 사용자가 매물 등록 신청 폼을 연다.                                                                                      |
| 1    | 사용자가 신청자 정보를 입력한다 (이름, 연락처, 매물과의 관계).                                                          |
| 2    | 사용자가 지도에서 주소를 검색하거나 좌표를 선택한다.                                                                    |
| 3    | 시스템이 지도 API를 통해 주소 정보를 조회한다 (`GET /api/ownership/map/address` 또는 `/api/ownership/map/coordinates`). |
| 4    | 사용자가 건물명, 상세주소, 우편번호를 입력한다.                                                                         |
| 5    | 사용자가 소유권 증명 서류 파일을 업로드한다.                                                                            |
| 6    | 시스템이 파일 검증을 수행한다 (크기, 형식).                                                                             |
| 7    | 사용자가 "신청하기" 버튼을 클릭한다.                                                                                    |
| 8    | 시스템이 JWT 토큰을 검증한다.                                                                                           |
| 9    | 시스템이 중복 신청 여부를 체크한다.                                                                                     |
| 10   | 시스템이 업로드 디렉토리를 생성한다 (존재하지 않는 경우).                                                               |
| 11   | 시스템이 파일들을 서버 저장소에 저장한다 (고유 파일명: `yyyyMMdd_HHmmss_UUID.확장자`).                                  |
| 12   | 시스템이 문서 정보를 데이터베이스에 저장한다.                                                                           |
| 13   | 시스템이 신청 정보를 데이터베이스에 저장한다 (Status: PENDING).                                                         |
| 14   | 시스템이 신청 ID를 포함한 응답을 반환한다.                                                                              |

## 1.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                                                                                       |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 6    | 6a. 파일이 비어있는 경우<br>- 6a1. "빈 파일은 업로드할 수 없습니다" 오류 메시지를 출력한다.<br><br>6b. 파일 크기가 10MB를 초과하는 경우<br>- 6b1. "파일 크기는 10MB를 초과할 수 없습니다" 오류 메시지를 출력한다.<br><br>6c. 지원하지 않는 파일 형식인 경우<br>- 6c1. "지원하지 않는 파일 형식입니다. PDF, JPG, PNG, DOCX만 업로드 가능합니다" 오류 메시지를 출력한다. |
| 8    | 8a. JWT 토큰이 유효하지 않은 경우<br>- 8a1. 401 Unauthorized 응답을 반환한다.                                                                                                                                                                                                                                                                                          |
| 9    | 9a. 같은 주소로 PENDING 상태 신청이 이미 존재하는 경우<br>- 9a1. "같은 주소로 심사 중인 신청이 이미 존재합니다" 오류 메시지를 출력한다.<br><br>9b. 기존 매물에 대해 이미 신청한 경우<br>- 9b1. "이미 해당 매물에 신청이 존재합니다" 오류 메시지를 출력한다.                                                                                                            |
| 11   | 11a. 파일 저장 실패 시<br>- 11a1. "파일 저장에 실패했습니다" 오류 메시지를 출력한다.<br><br>11b. 파일 개수와 문서 타입 개수가 일치하지 않는 경우<br>- 11b1. "파일 개수와 문서 타입 개수가 일치하지 않습니다" 오류 메시지를 출력한다.                                                                                                                                   |
| 13   | 13a. 사용자가 존재하지 않는 경우<br>- 13a1. "사용자가 존재하지 않습니다" 오류 메시지를 출력한다.                                                                                                                                                                                                                                                                       |
| \*   | \*a. 기타 예외 발생 시<br>- \*a1. "매물 등록 처리 중 오류가 발생했습니다" 오류 메시지를 출력한다.                                                                                                                                                                                                                                                                      |

## 1.4 RELATED INFORMATION

1.4.1 Performance : ≤ 1 second

1.4.2 Frequency

- 사용자당 신청 빈도 제한 없음
- 중복 신청 방지 로직 존재

  1.4.3 Concurrency : 제한없음

  1.4.4 Due Date : None

# Use case 2. 매물 신청 현황 조회

## 2.1 GENERAL CHARACTERISTICS

2.1.1 Summary : 사용자가 신청한 매물들의 상태를 확인한다.

2.1.2 Scope : None

2.1.3 Level : user level

2.1.4 Author : None

2.1.5 Last Update : None

2.1.6 Status : Implemented

2.1.7 Primary Actor : User

2.1.8 Preconditions

- 사용자가 로그인되어 있어야 함 (JWT 토큰 보유)
- `/api/ownership/**` 엔드포인트는 인증된 사용자만 접근 가능

  2.1.9 Trigger

- 사용자가 내 신청 내역 페이지에 접근하거나 특정 신청 상세를 조회할 때

  2.1.10 Success Post Conditions

- 사용자의 모든 신청 내역이 목록으로 표시됨
- 각 신청의 상태(심사중/승인됨/거절됨)가 표시됨
- 심사중인 경우 남은 일수가 표시됨 (마감일: 수정일 + 7일)
- 거절된 경우 거절 사유가 표시됨
- 첨부된 서류를 원본 파일명으로 다운로드 가능

  2.1.11 Failure Post Conditions

- 신청 내역 조회 실패 시 오류 메시지 출력
- 권한이 없는 신청 접근 시 오류 메시지 출력

## 2.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                         |
| ---- | ---------------------------------------------------------------------------------------------- |
| S    | 사용자가 내 신청 내역 페이지에 접근한다.                                                       |
| 1    | 시스템이 JWT 토큰을 검증한다.                                                                  |
| 2    | 시스템이 현재 사용자 ID로 ownership_claims 테이블을 조회한다 (`GET /api/ownership/my-claims`). |
| 3    | 시스템이 각 신청의 상태를 확인한다 (PENDING/APPROVED/REJECTED).                                |
| 4    | 시스템이 신청 목록을 반환한다 (신청 ID, 주소, 상태, 신청일, 마감일 등).                        |
| 5    | 사용자가 특정 신청을 클릭하여 상세 정보를 조회한다.                                            |
| 6    | 시스템이 해당 신청의 상세 정보를 조회한다 (`GET /api/ownership/claims/{claimId}`).             |
| 7    | 시스템이 신청자 정보, 매물 정보, 첨부 서류 목록을 반환한다.                                    |
| 8    | 상태가 'APPROVED'인 경우 '승인됨'으로 표시한다.                                                |
| 9    | 상태가 'PENDING'인 경우 '심사중'으로 표시하고 남은 일수를 계산하여 표시한다 (마감일 - 현재일). |
| 10   | 상태가 'REJECTED'인 경우 '거절됨'으로 표시하고 거절 사유를 함께 표시한다.                      |
| 11   | 사용자가 첨부 서류의 다운로드 버튼을 클릭한다.                                                 |
| 12   | 시스템이 문서 정보를 조회한다 (`GET /api/ownership/documents/{documentId}/download`).          |
| 13   | 시스템이 파일 존재 여부와 읽기 가능 여부를 확인한다.                                           |
| 14   | 시스템이 원본 파일명으로 인코딩하여 파일을 다운로드한다.                                       |

## 2.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                              |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. JWT 토큰이 유효하지 않은 경우<br>- 1a1. 401 Unauthorized 응답을 반환한다.                                                                                                                                 |
| 2    | 2a. 신청 내역이 없는 경우<br>- 2a1. 빈 목록을 반환한다.                                                                                                                                                       |
| 6    | 6a. 신청을 찾을 수 없는 경우<br>- 6a1. "신청을 찾을 수 없습니다" 오류 메시지를 출력한다.<br><br>6b. 다른 사용자의 신청에 접근하려는 경우<br>- 6b1. "접근 권한이 없습니다" 오류 메시지를 출력한다.             |
| 12   | 12a. 문서를 찾을 수 없는 경우<br>- 12a1. "문서를 찾을 수 없습니다" 오류 메시지를 출력한다.                                                                                                                    |
| 13   | 13a. 파일이 존재하지 않거나 읽을 수 없는 경우<br>- 13a1. "파일을 읽을 수 없습니다" 오류 메시지를 출력한다.                                                                                                    |
| 14   | 14a. 파일 경로가 잘못된 경우<br>- 14a1. "파일 경로가 잘못되었습니다" 오류 메시지를 출력한다.<br><br>14b. 파일 다운로드 중 오류 발생<br>- 14b1. "파일 다운로드 중 오류가 발생했습니다" 오류 메시지를 출력한다. |

## 2.4 RELATED INFORMATION

2.4.1 Performance : ≤ 1 second

2.4.2 Frequency

- 사용자가 내 신청 내역 페이지 접근 시마다
- 특정 신청 상세 조회 시마다
- 서류 다운로드 시마다

  2.4.3 Concurrency : 제한없음

  2.4.4 Due Date : None

# Use case 3. 매물 관리 현황 요약

## 3.1 GENERAL CHARACTERISTICS

3.1.1 Summary : 전체 매물 관리 상황을 한눈에 파악할 수 있도록 요약 정보를 제공한다.

3.1.2 Scope : None

3.1.3 Level : user level

3.1.4 Author : None

3.1.5 Last Update : None

3.1.6 Status : Implemented

3.1.7 Primary Actor : User

3.1.8 Preconditions

- 사용자가 로그인되어 있어야 함 (JWT 토큰 보유)
- `/api/ownership/**` 엔드포인트는 인증된 사용자만 접근 가능

  3.1.9 Trigger

- 사용자가 매물 관리 대시보드 또는 내 신청 내역 페이지에 접근할 때

  3.1.10 Success Post Conditions

- 각 상태별(심사중/승인됨/거절됨) 매물 건수가 표시됨
- 매물 목록이 제목, 주소, 상태, 신청자 정보와 함께 표시됨
- 상태별로 색상과 라벨이 구분되어 직관적으로 확인 가능
- 매물이 없는 경우 안내 문구 표시

  3.1.11 Failure Post Conditions

- 매물 목록 조회 실패 시 오류 메시지 출력

## 3.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                                          |
| ---- | --------------------------------------------------------------------------------------------------------------- |
| S    | 사용자가 매물 관리 대시보드에 접근한다.                                                                         |
| 1    | 시스템이 JWT 토큰을 검증한다.                                                                                   |
| 2    | 시스템이 현재 사용자 ID로 ownership_claims 테이블을 조회한다 (`GET /api/ownership/my-claims`).                  |
| 3    | 시스템이 조회된 신청 목록을 반환한다.                                                                           |
| 4    | 시스템이 각 신청의 상태(PENDING/APPROVED/REJECTED)를 확인한다.                                                  |
| 5    | 시스템이 상태별 건수를 계산한다.                                                                                |
| 6    | 시스템이 심사중(PENDING) 건수를 표시한다.                                                                       |
| 7    | 시스템이 승인됨(APPROVED) 건수를 표시한다.                                                                      |
| 8    | 시스템이 거절됨(REJECTED) 건수를 표시한다.                                                                      |
| 9    | 시스템이 각 매물의 제목, 주소, 상태, 신청자 정보를 목록으로 표시한다.                                           |
| 10   | 시스템이 상태별로 색상과 라벨을 구분하여 표시한다 (PENDING: 노란색/주황색, APPROVED: 초록색, REJECTED: 빨간색). |
| 11   | 사용자가 매물 목록을 확인한다.                                                                                  |

## 3.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                    |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. JWT 토큰이 유효하지 않은 경우<br>- 1a1. 401 Unauthorized 응답을 반환한다.                                                                       |
| 2    | 2a. 매물 목록 조회 실패<br>- 2a1. 오류 메시지를 표시한다.<br>- 2a2. 재시도 버튼을 제공한다.                                                         |
| 3    | 3a. 신청 내역이 없는 경우 (빈 목록 반환)<br>- 3a1. "현재 등록된 매물이 없습니다" 안내 문구를 표시한다.<br>- 3a2. 상태별 건수를 모두 0으로 표시한다. |

## 3.4 RELATED INFORMATION

3.4.1 Performance : ≤ 1 second

3.4.2 Frequency

- 매물 관리 대시보드 접근 시마다

  3.4.3 Concurrency : 제한없음

  3.4.4 Due Date : None

# Use case 4. 지도 위치 설정 기능

## 4.1 GENERAL CHARACTERISTICS

4.1.1 Summary : 사용자가 지도를 통해 정확한 매물 위치를 설정하도록 한다.

4.1.2 Scope : None

4.1.3 Level : user level

4.1.4 Author : None

4.1.5 Last Update : None

4.1.6 Status : Implemented

4.1.7 Primary Actor : User

4.1.8 Preconditions

- 사용자가 로그인되어 있어야 함 (JWT 토큰 보유)
- 매물 등록 신청 폼이 열려 있어야 함
- 지도 API 서비스가 정상 작동해야 함

  4.1.9 Trigger

- 사용자가 매물 등록 신청 시 지도에서 위치를 선택하거나 주소를 입력할 때

  4.1.10 Success Post Conditions

- 선택한 위치의 좌표(latitude, longitude)가 저장됨
- 좌표에 해당하는 주소 정보가 자동으로 조회되어 표시됨
- 주소 필드에 도로명주소, 지번주소, 건물명, 우편번호가 자동 완성됨
- 매물 신청 시 위치 정보가 함께 저장됨

  4.1.11 Failure Post Conditions

- 지도 API 호출 실패 시 오류 메시지 출력
- 위치 정보가 저장되지 않음

## 4.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                                           |
| ---- | ---------------------------------------------------------------------------------------------------------------- |
| S    | 사용자가 매물 등록 신청 폼에서 지도를 연다.                                                                      |
| 1    | 시스템이 지도를 표시한다 (확대, 축소, 이동 가능).                                                                |
| 2    | 사용자가 지도에서 원하는 위치를 클릭한다.                                                                        |
| 3    | 시스템이 클릭한 위치의 좌표(latitude, longitude)를 저장한다.                                                     |
| 4    | 시스템이 해당 위치에 마커를 표시한다.                                                                            |
| 5    | 시스템이 좌표로 주소를 조회한다 (`GET /api/ownership/map/address?latitude={lat}&longitude={lng}`).               |
| 6    | 시스템이 Reverse Geocoding을 수행하여 주소 정보를 반환한다.                                                      |
| 7    | 시스템이 도로명주소, 지번주소, 건물명, 우편번호를 주소 필드에 자동 완성한다.                                     |
| 8    | 사용자가 자동 완성된 주소 정보를 확인한다.                                                                       |
| 9    | 사용자가 필요시 상세주소를 추가 입력한다.                                                                        |
| 10   | 사용자가 신청하기 버튼을 클릭한다.                                                                               |
| 11   | 시스템이 위치 정보(propertyAddress, locationX, locationY, buildingName, postalCode)를 매물 신청과 함께 저장한다. |

## 4.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                                                                                                                         |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2    | 2a. 사용자가 주소를 직접 입력하는 경우<br>- 2a1. 사용자가 주소 검색창에 주소를 입력한다.<br>- 2a2. 시스템이 주소로 좌표를 조회한다 (`GET /api/ownership/map/coordinates?address={address}`).<br>- 2a3. 시스템이 Geocoding을 수행하여 좌표를 반환한다.<br>- 2a4. 시스템이 지도 중심을 해당 좌표로 이동한다.<br>- 2a5. 시스템이 해당 위치에 마커를 표시한다.<br>- 2a6. 시스템이 주소 필드를 자동 완성한다. |
| 3    | 3a. 사용자가 마커를 드래그하여 위치를 변경하는 경우<br>- 3a1. 시스템이 새로운 좌표를 저장한다.<br>- 3a2. 시스템이 새로운 좌표로 주소를 재조회한다.<br>- 3a3. 시스템이 주소 필드를 업데이트한다.                                                                                                                                                                                                          |
| 5    | 5a. 지도 API 호출 실패<br>- 5a1. "주소 조회에 실패했습니다" 오류 메시지를 표시한다.<br>- 5a2. 사용자가 주소를 수동으로 입력할 수 있도록 한다.                                                                                                                                                                                                                                                            |
| 6    | 6a. 좌표에 해당하는 주소를 찾을 수 없는 경우<br>- 6a1. 기본 주소 정보를 반환한다 (서울시청 기준).<br>- 6a2. 사용자에게 주소를 수동으로 확인하도록 안내한다.                                                                                                                                                                                                                                              |
| \*   | \*a. 주변 건물 검색 기능 사용<br>- \*a1. 사용자가 주변 건물 검색 버튼을 클릭한다.<br>- \*a2. 시스템이 현재 위치 기준 반경 500m 내 건물을 조회한다 (`GET /api/ownership/map/nearby-buildings`).<br>- \*a3. 시스템이 건물 목록을 표시한다 (건물명, 카테고리, 주소, 거리).<br>- \*a4. 사용자가 건물을 선택하면 해당 위치로 이동한다.                                                                        |

## 4.4 RELATED INFORMATION

4.4.1 Performance : ≤ 1 second

4.4.2 Frequency

- 매물 등록 신청 시마다
- 지도에서 위치 변경 시마다
- 주소 입력 시마다

  4.4.3 Concurrency : 제한없음, 동시 API 호출 지원, 지도 API 응답 시간에 따라 성능 변동 가능

  4.4.4 Due Date : None

# Use case 5. 소유권 증명 서류 업로드

## 5.1 GENERAL CHARACTERISTICS

5.1.1 Summary : 다양한 종류의 소유권 증명 서류를 업로드 할 수 있다.

5.1.2 Scope : None

5.1.3 Level : user level

5.1.4 Author : None

5.1.5 Last Update : None

5.1.6 Status : Implemented

5.1.7 Primary Actor : User

5.1.8 Preconditions

- 사용자가 로그인되어 있어야 함 (JWT 토큰 보유)
- 매물 등록 신청 폼이 열려 있어야 함

  5.1.9 Trigger

- 사용자가 매물 등록 신청 시 서류 업로드 버튼을 클릭할 때

  5.1.10 Success Post Conditions

- 업로드된 파일이 서버 저장소에 저장됨 (`uploads/ownership/`)
- 파일 정보가 ownership_documents 테이블에 저장됨
- 원본 파일명, 저장 파일명, 파일 크기, 업로드 시간이 기록됨
- 관리자가 추후 확인 가능

  5.1.11 Failure Post Conditions

- 파일 업로드 실패 시 오류 메시지 출력
- 파일이 저장되지 않음

## 5.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                         |
| ---- | ---------------------------------------------------------------------------------------------- |
| S    | 사용자가 매물 등록 신청 폼에서 서류 업로드 섹션을 연다.                                        |
| 1    | 시스템이 서류 타입 목록을 조회한다 (`GET /api/ownership/document-types`).                      |
| 2    | 시스템이 드롭다운에 서류 타입을 표시한다 (등기부등본, 신분증, 주민등록등본, 납세증명서, 기타). |
| 3    | 사용자가 드롭다운에서 서류 타입을 선택한다.                                                    |
| 4    | 사용자가 파일 선택 버튼을 클릭하여 파일을 선택한다.                                            |
| 5    | 시스템이 파일 형식을 검증한다 (PDF, JPG, PNG, DOCX, DOC).                                      |
| 6    | 시스템이 파일 크기를 검증한다 (10MB 이하).                                                     |
| 7    | 사용자가 추가 서류를 업로드하기 위해 "서류 추가" 버튼을 클릭한다.                              |
| 8    | 시스템이 새로운 서류 입력 필드를 추가한다.                                                     |
| 9    | 사용자가 여러 개의 서류를 선택한다.                                                            |
| 10   | 사용자가 신청하기 버튼을 클릭한다.                                                             |
| 11   | 시스템이 파일 개수와 문서 타입 개수가 일치하는지 확인한다.                                     |
| 12   | 시스템이 각 파일을 서버 저장소에 저장한다 (고유 파일명: `yyyyMMdd_HHmmss_UUID.확장자`).        |
| 13   | 시스템이 각 파일 정보를 ownership_documents 테이블에 저장한다.                                 |
| 14   | 시스템이 원본 파일명, 저장 파일명, 파일 경로, 파일 크기, 콘텐츠 타입, 업로드 시간을 기록한다.  |
| 15   | 시스템이 신청 완료 메시지를 표시한다.                                                          |

## 5.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 5    | 5a. 지원하지 않는 파일 형식인 경우<br>- 5a1. "지원하지 않는 파일 형식입니다. PDF, JPG, PNG, DOCX만 업로드 가능합니다" 오류 메시지를 출력한다.<br>- 5a2. 파일 선택을 취소한다.                                                                                                   |
| 6    | 6a. 파일 크기가 10MB를 초과하는 경우<br>- 6a1. "파일 크기는 10MB를 초과할 수 없습니다" 오류 메시지를 출력한다.<br>- 6a2. 파일 선택을 취소한다.<br><br>6b. 빈 파일을 업로드하는 경우<br>- 6b1. "빈 파일은 업로드할 수 없습니다" 오류 메시지를 출력한다.                          |
| 11   | 11a. 파일 개수와 문서 타입 개수가 일치하지 않는 경우<br>- 11a1. "파일 개수와 문서 타입 개수가 일치하지 않습니다" 오류 메시지를 출력한다.<br>- 11a2. 사용자에게 서류 타입을 다시 선택하도록 안내한다.                                                                            |
| 12   | 12a. 파일 저장 실패<br>- 12a1. "파일 저장에 실패했습니다" 오류 메시지를 출력한다.<br>- 12a2. 업로드를 중단한다.<br><br>12b. 업로드 디렉토리가 존재하지 않는 경우<br>- 12b1. 시스템이 자동으로 디렉토리를 생성한다 (`uploads/ownership/`).<br>- 12b2. 파일 저장을 계속 진행한다. |

## 5.4 RELATED INFORMATION

5.4.1 Performance : ≤ 1 second

5.4.2 Frequency

- 매물 등록 신청 시마다
- 매물 수정 시마다

  5.4.3 Concurrency : 제한없음, 동시 업로드 지원, 파일명 충돌 방지 - 타임스탬프 + UUID 조합

  5.4.4 Due Date : None

# Use case 6. 심사 중 매물 신청 수정

## 6.1 GENERAL CHARACTERISTICS

6.1.1 Summary : 사용자가 심사중인 매물 신청 정보를 수정할 수 있다.

6.1.2 Scope : None

6.1.3 Level : user level

6.1.4 Author : None

6.1.5 Last Update : None

6.1.6 Status : Implemented

6.1.7 Primary Actor : User

6.1.8 Preconditions

- 사용자가 로그인되어 있어야 함 (JWT 토큰 보유)
- 수정하려는 신청이 존재해야 함
- 신청 상태가 PENDING(심사중)이어야 함

  6.1.9 Trigger

- 사용자가 심사중인 신청의 수정 버튼을 클릭할 때

  6.1.10 Success Post Conditions

- 신청 정보가 수정됨
- 수정된 정보가 데이터베이스에 저장됨
- 감사 로그에 수정 이력이 기록됨
- updatedAt 필드가 현재 시간으로 갱신됨

  6.1.11 Failure Post Conditions

- 신청 정보가 수정되지 않음
- 오류 메시지 출력

## 6.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                      |
| ---- | --------------------------------------------------------------------------- |
| S    | 사용자가 내 신청 내역에서 심사중인 신청을 선택한다.                         |
| 1    | 시스템이 신청 상태를 확인한다 (PENDING 여부).                               |
| 2    | 시스템이 수정 버튼을 활성화한다.                                            |
| 3    | 사용자가 수정 버튼을 클릭한다.                                              |
| 4    | 시스템이 기존 신청 정보를 수정 폼에 표시한다.                               |
| 5    | 사용자가 필요한 항목을 변경한다 (신청자 정보, 주소, 위치, 첨부 서류 등).    |
| 6    | 사용자가 수정 완료 버튼을 클릭한다.                                         |
| 7    | 시스템이 JWT 토큰을 검증한다.                                               |
| 8    | 시스템이 신청을 조회한다 (`PUT /api/ownership/claims/{claimId}`).           |
| 9    | 시스템이 수정 권한을 확인한다 (본인의 신청인지).                            |
| 10   | 시스템이 신청 상태를 확인한다 (PENDING 상태인지).                           |
| 11   | 시스템이 기본 정보를 업데이트한다 (이름, 연락처, 매물과의 관계, 추가 정보). |
| 12   | 시스템이 위치 정보를 업데이트한다 (주소, 좌표, 건물명, 상세주소, 우편번호). |
| 13   | 새로운 파일이 업로드된 경우 기존 문서를 삭제하고 새 문서를 저장한다.        |
| 14   | 시스템이 updatedAt 필드를 현재 시간으로 갱신한다 (PreUpdate).               |
| 15   | 시스템이 감사 로그를 생성한다 (UPDATE_CLAIM 액션).                          |
| 16   | 시스템이 수정된 신청 정보를 반환한다.                                       |

## 6.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                         |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 신청 상태가 APPROVED(승인됨)인 경우<br>- 1a1. 수정 버튼을 비활성화한다.<br>- 1a2. "승인된 신청은 수정할 수 없습니다" 안내 메시지를 표시한다.<br><br>1b. 신청 상태가 REJECTED(거절됨)인 경우<br>- 1b1. 수정 버튼을 비활성화한다.<br>- 1b2. "거절된 신청은 수정할 수 없습니다" 안내 메시지를 표시한다. |
| 7    | 7a. JWT 토큰이 유효하지 않은 경우<br>- 7a1. 401 Unauthorized 응답을 반환한다.                                                                                                                                                                                                                            |
| 8    | 8a. 신청을 찾을 수 없는 경우<br>- 8a1. "신청을 찾을 수 없습니다" 오류 메시지를 출력한다.                                                                                                                                                                                                                 |
| 9    | 9a. 다른 사용자의 신청을 수정하려는 경우<br>- 9a1. "수정 권한이 없습니다" 오류 메시지를 출력한다.                                                                                                                                                                                                        |
| 10   | 10a. 신청 상태가 PENDING이 아닌 경우<br>- 10a1. "심사중인 신청만 수정할 수 있습니다" 오류 메시지를 출력한다.                                                                                                                                                                                             |
| 13   | 13a. 파일 업로드 실패<br>- 13a1. 파일 저장 오류 메시지를 출력한다.<br>- 13a2. 기존 정보는 유지된다.                                                                                                                                                                                                      |

## 6.4 RELATED INFORMATION

6.4.1 Performance : ≤ 1 second (파일 업로드 제외), 파일 업로드 시간은 파일 크기에 따라 다름, 기존 문서 삭제 후 새 문서 업로드, 감사 로그 자동 생성

6.4.2 Frequency

- 사용자가 신청 수정 시마다
- PENDING 상태인 신청만 수정 가능

  6.4.3 Concurrency : 제한없음, 트랜잭션 관리로 데이터 일관성 보장, PreUpdate로 updatedAt 자동 갱신

  6.4.4 Due Date : None

# Use case 7. 관리자 매물 신청 검토 및 처리

## 7.1 GENERAL CHARACTERISTICS

7.1.1 Summary : 관리자가 신청을 검토하고 승인 또는 거절한다.

7.1.2 Scope : None

7.1.3 Level : user level

7.1.4 Author : None

7.1.5 Last Update : None

7.1.6 Status : Implemented

7.1.7 Primary Actor : Admin

7.1.8 Preconditions

- 관리자 권한으로 로그인되어 있어야 함
- 검토할 신청이 존재해야 함

  7.1.9 Trigger

- 관리자가 신청 목록에 접근하거나 특정 신청을 검토할 때

  7.1.10 Success Post Conditions

- 신청 상태가 APPROVED 또는 REJECTED로 변경됨
- 승인 시 Property 엔티티가 자동 생성됨
- 거절 시 거절 사유가 저장됨
- 검토 시간(reviewedAt)이 기록됨
- 감사 로그에 검토 이력이 기록됨
- 사용자에게 알림이 전송됨

  7.1.11 Failure Post Conditions

- 신청 상태가 변경되지 않음
- 오류 메시지 출력

## 7.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                           |
| ---- | ------------------------------------------------------------------------------------------------ |
| S    | 관리자가 관리자 페이지에 접근한다.                                                               |
| 1    | 시스템이 관리자 권한을 확인한다 (role = "admin").                                                |
| 2    | 시스템이 모든 신청 내역을 조회한다 (`GET /api/ownership/admin/claims`).                          |
| 3    | 시스템이 신청 목록을 리스트 형태로 표시한다 (신청자, 주소, 상태, 신청일 등).                     |
| 4    | 관리자가 특정 신청을 선택한다.                                                                   |
| 5    | 시스템이 신청 상세 정보를 조회한다 (`GET /api/ownership/admin/claims/{claimId}`).                |
| 6    | 시스템이 신청자 정보, 매물 정보, 첨부 서류 목록을 표시한다.                                      |
| 7    | 관리자가 첨부 서류를 확인한다 (다운로드 가능).                                                   |
| 8    | 관리자가 승인 또는 거절을 결정한다.                                                              |
| 9    | 관리자가 승인 버튼을 클릭한다.                                                                   |
| 10   | 시스템이 신청 상태를 APPROVED로 변경한다 (`POST /api/ownership/admin/claims/{claimId}/approve`). |
| 11   | 시스템이 검토자(admin)와 검토 시간(reviewedAt)을 기록한다.                                       |
| 12   | 시스템이 Property 엔티티를 자동 생성한다.                                                        |
| 13   | 시스템이 매물 제목을 자동 생성한다 (건물명 또는 주소 기반, 중복 방지).                           |
| 14   | 시스템이 Property 정보를 저장한다 (제목, 주소, 상태=AVAILABLE, 등록유형=OWNER, 소유자, 좌표).    |
| 15   | 시스템이 신청과 Property를 연결한다 (역참조 설정).                                               |
| 16   | 시스템이 감사 로그를 생성한다 (APPROVE_CLAIM 액션, 신청자/주소 정보 포함).                       |
| 17   | 시스템이 사용자에게 승인 알림을 전송한다 (제목: "매물 승인 완료", 메시지: 주소 포함).            |
| 18   | 시스템이 승인 완료 메시지를 표시한다.                                                            |

## 7.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 관리자 권한이 없는 경우<br>- 1a1. "관리자 권한이 필요합니다" 오류 메시지를 출력한다.<br>- 1a2. 403 Forbidden 응답을 반환한다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 5    | 5a. 신청을 찾을 수 없는 경우<br>- 5a1. "신청을 찾을 수 없습니다" 오류 메시지를 출력한다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 9    | 9a. 관리자가 거절 버튼을 클릭하는 경우<br>- 9a1. 시스템이 거절 사유 입력 창을 표시한다.<br>- 9a2. 관리자가 거절 사유를 입력한다.<br>- 9a3. 시스템이 신청 상태를 REJECTED로 변경한다 (`POST /api/ownership/admin/claims/{claimId}/reject`).<br>- 9a4. 시스템이 거절 사유(rejectionReason)를 저장한다.<br>- 9a5. 시스템이 검토자(admin)와 검토 시간(reviewedAt)을 기록한다.<br>- 9a6. 시스템이 감사 로그를 생성한다 (REJECT_CLAIM 액션, 거절 사유 포함).<br>- 9a7. 시스템이 사용자에게 거절 알림을 전송한다 (제목: "매물 신청 거절", 메시지: 거절 사유 포함).<br>- 9a8. 시스템이 거절 완료 메시지를 표시한다. |
| 10   | 10a. 관리자를 찾을 수 없는 경우<br>- 10a1. "관리자를 찾을 수 없습니다" 오류 메시지를 출력한다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 12   | 12a. 이미 Property가 연결되어 있는 경우<br>- 12a1. Property 생성을 건너뛴다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 13   | 13a. 매물 제목 중복 발생<br>- 13a1. 제목 뒤에 번호를 추가한다 (예: "강남역 (1)", "강남역 (2)").<br>- 13a2. 중복이 없을 때까지 번호를 증가시킨다.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

## 7.4 RELATED INFORMATION

7.4.1 Performance : ≤ 2 second

7.4.2 Frequency

- 관리자가 신청 검토 시마다
- 승인/거절 처리 시마다

  7.4.3 Concurrency : 제한없음, 트랜잭션 관리로 데이터 일관성 보장, 감사 로그로 모든 검토 이력 추적 가능, 알림 시스템으로 사용자에게 실시간 전달

  7.4.4 Due Date : None

# Use case 8. 매물 자동 생성

## 8.1 GENERAL CHARACTERISTICS

8.1.1 Summary : 승인된 신청 정보를 기반으로 매물을 자동 생성한다.

8.1.2 Scope : None

8.1.3 Level : system level

8.1.4 Author : None

8.1.5 Last Update : None

8.1.6 Status : Implemented

8.1.7 Primary Actor : System

8.1.8 Preconditions

- 매물 신청이 존재해야 함
- 관리자가 신청을 승인해야 함
- 신청 상태가 APPROVED로 변경되어야 함

  8.1.9 Trigger

- 관리자가 신청 승인 버튼을 클릭하여 승인 처리가 완료될 때

  8.1.10 Success Post Conditions

- Property 엔티티가 데이터베이스에 생성됨
- 신청(OwnershipClaim)과 매물(Property)이 서로 참조됨 (양방향 관계)
- 매물 제목이 중복되지 않도록 자동 생성됨
- 매물과 사용자(소유자) 간 관계가 매핑됨
- 지도 좌표가 Property 엔티티에 저장됨
- 매물 상태가 AVAILABLE로 설정됨

  8.1.11 Failure Post Conditions

- Property 엔티티가 생성되지 않음
- 신청과 매물 간 참조 관계가 설정되지 않음

## 8.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                            |
| ---- | --------------------------------------------------------------------------------- |
| S    | 관리자가 신청 승인 처리를 완료한다.                                               |
| 1    | 시스템이 createPropertyFromClaim 메서드를 호출한다.                               |
| 2    | 시스템이 이미 Property가 연결되어 있는지 확인한다.                                |
| 3    | 시스템이 매물 제목을 자동 생성한다 (generatePropertyTitle 메서드 호출).           |
| 4    | 시스템이 건물명이 있는지 확인한다.                                                |
| 5    | 건물명이 있으면 건물명을 제목으로 사용한다.                                       |
| 6    | 건물명이 없으면 주소에서 동/구 정보를 추출하여 제목을 생성한다.                   |
| 7    | 상세주소가 있으면 제목에 추가한다.                                                |
| 8    | 시스템이 제목 중복 여부를 확인한다 (propertyRepository.existsByTitle).            |
| 9    | 중복이 있으면 제목 뒤에 번호를 추가한다 (예: "강남역 (1)", "강남역 (2)").         |
| 10   | 중복이 없을 때까지 번호를 증가시킨다.                                             |
| 11   | 시스템이 Property 엔티티를 생성한다.                                              |
| 12   | 시스템이 제목(title)을 설정한다.                                                  |
| 13   | 시스템이 주소(address)를 설정한다 (신청의 propertyAddress 또는 "주소 정보 없음"). |
| 14   | 시스템이 상태(status)를 AVAILABLE로 설정한다.                                     |
| 15   | 시스템이 등록 유형(listingType)을 OWNER로 설정한다.                               |
| 16   | 시스템이 소유자(owner)를 신청자로 설정한다.                                       |
| 17   | 시스템이 신청(claim)을 연결한다.                                                  |
| 18   | 시스템이 좌표(locationX, locationY)를 설정한다.                                   |
| 19   | 시스템이 이상치 여부(anomalyAlert)를 false로 설정한다.                            |
| 20   | 시스템이 Property를 데이터베이스에 저장한다.                                      |
| 21   | 시스템이 신청(claim)에 Property를 역참조로 설정한다.                              |
| 22   | 시스템이 신청을 데이터베이스에 저장한다 (양방향 관계 완성).                       |

## 8.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                      |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2    | 2a. 이미 Property가 연결되어 있는 경우<br>- 2a1. Property 생성을 건너뛴다.<br>- 2a2. 메서드를 종료한다.                                                               |
| 4    | 4a. 건물명이 없는 경우<br>- 4a1. 주소 정보를 확인한다.<br>- 4a2. 주소를 공백으로 분리한다.<br>- 4a3. 마지막 두 부분을 제목으로 사용한다 (동/구 정보).                 |
| 6    | 6a. 주소도 없는 경우<br>- 6a1. "매물"을 기본 제목으로 사용한다.                                                                                                       |
| 8    | 8a. 제목이 중복되는 경우<br>- 8a1. 제목 뒤에 " (1)"을 추가한다.<br>- 8a2. 여전히 중복이면 번호를 증가시킨다 " (2)", " (3)" 등.<br>- 8a3. 중복이 없을 때까지 반복한다. |
| 13   | 13a. 주소 정보가 없는 경우<br>- 13a1. "주소 정보 없음"을 기본값으로 설정한다.                                                                                         |

## 8.4 RELATED INFORMATION

8.4.1 Performance : ≤ 1 second

8.4.2 Frequency

- 신청 승인 시마다 자동 실행
- 승인 프로세스의 일부로 실행

  8.4.3 Concurrency : 제한없음, 트랜잭션 내에서 실행되어 데이터 일관성 보장, 제목 중복 체크로 동시성 문제 방지

  8.4.4 Due Date : None

# Use case 9. 채팅방 접속 및 생성

## 9.1 GENERAL CHARACTERISTICS

9.1.1 Summary : 사용자가 매물 상세 페이지에서 채팅방에 접속하거나, 없을 경우 새로운 채팅방을 생성한다.

9.1.2 Scope : None

9.1.3 Level : user level

9.1.4 Author : 김도림

9.1.5 Last Update : None

9.1.6 Status : Analysis

9.1.7 Primary Actor : User(logined)

9.1.8 Preconditions

- 로그인이 되어 있어야 한다

  9.1.9 Trigger

- 채팅 버튼을 누른다

  9.1.10 Success Post Conditions

- 기존 채팅방이 존재하면 입장하고, 없을 경우 새로운 채팅방이 생성된다
- 채팅방에는 참여자 정보와 생성 시각이 기록된다

  9.1.11 Failure Post Conditions

- 채팅방 생성 또는 접속에 실패하면 오류 메시지가 출력된다

## 9.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                      |
| ---- | --------------------------------------------------------------------------- |
| S    | 사용자가 매물 상세 화면에서 '대화하기' 버튼을 클릭한다.                     |
| 1    | 시스템이 사용자의 로그인 상태와 토큰을 확인한다.                            |
| 2    | 시스템이 매물 ID와 사용자 정보를 기반으로 기존 채팅방 존재 여부를 조회한다. |
| 3    | 기존 채팅방이 있으면 해당 방으로 입장한다.                                  |
| 4    | 채팅방이 없으면 새로운 채팅방을 생성한다.                                   |
| 5    | 채팅방 생성 시 참여자 정보(판매자–구매자–중개인)와 생성 시각을 기록한다.    |
| 6    | 채팅방 화면으로 전환되어 메시지 목록을 불러온다.                            |

## 9.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                             |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1    | 1a. 로그인을 하지 않은 상태이다.<br>- 1a1. 로그인하지 않은 상태에서 버튼을 누르면 오류 메시지를 띄우고 로그인 화면으로 이동한다.                                                                                                                             |
| 2    | 2a. 채팅방이 존재한다<br>- 2a1. 기존 채팅방이 존재하면 새로 생성하지 않고 해당 방으로 이동한다.                                                                                                                                                              |
| 4    | 4a. 동일 매물 및 참여자 조합이 존재한다<br>- 4a1. 동일 매물 및 동일 참여자 조합의 채팅방이 이미 존재하면 오류 메시지를 표시한다.<br><br>4b. 서버 오류나 네트워크 오류가 발생한다.<br>- 4b1. 서버 오류나 네트워크 실패 시 재시도 버튼과 오류 안내를 표시한다. |

## 9.4 RELATED INFORMATION

9.4.1 Performance : ≤ 2 seconds (채팅방 생성 또는 입장까지)

9.4.2 Frequency

- 사용자가 매물 상세 화면에서 채팅 기능을 사용할 때마다

  9.4.3 Concurrency : 동일 매물에 대해 여러 사용자가 동시에 시도할 수 있으나, 시스템은 중복 채팅방 생성을 방지한다.

  9.4.4 Due Date : None

# Use case 10. 메시지 송수신

## 10.1 GENERAL CHARACTERISTICS

10.1.1 Summary : 사용자가 채팅방에서 텍스트 메시지를 주고받을 수 있다.

10.1.2 Scope : None

10.1.3 Level : user level

10.1.4 Author : 김도림

10.1.5 Last Update : None

10.1.6 Status : Analysis

10.1.7 Primary Actor : 로그인한 사용자

10.1.8 Preconditions

- 로그인 상태이며, 유효한 채팅방(room_id)에 입장한 상태여야 한다.

  10.1.9 Trigger

- 사용자가 채팅 입력창에 메시지를 작성하고 전송 버튼을 누른다.

  10.1.10 Success Post Conditions

- 메시지가 Supabase 데이터베이스의 chat_message 테이블에 저장된다.
- 주기적 조회(또는 실시간 구독) 로직을 통해 새로운 메시지가 화면에 표시된다.
- 각 메시지에는 발신자, 발신 시각, 읽음 여부가 함께 기록된다.

  10.1.11 Failure Post Conditions

- 메시지가 비어 있거나 DB 쓰기 실패 시 전송되지 않으며 오류 메시지가 표시된다.

## 10.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                |
| ---- | ------------------------------------------------------------------------------------- |
| S    | 사용자가 채팅 입력창에 메시지를 작성한다.                                             |
| 1    | 시스템이 입력된 메시지가 비어 있지 않은지 검증한다.                                   |
| 2    | 사용자가 전송 버튼을 누르면, 시스템이 chat_message 테이블에 메시지를 INSERT 요청한다. |
| 3    | Supabase를 통해 메시지 데이터(방 ID, 작성자, 내용, 작성시각)를 저장한다.              |
| 4    | DB에 저장 성공 시 시스템이 로컬 메시지 목록에 즉시 반영한다.                          |

## 10.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                    |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2    | 2a. 네트워크 또는 DB 연결 오류 발생<br>- 2a1. 시스템이 오류를 감지하고 "전송 실패" 안내를 표시한다.<br>- 2a2. 재시도 버튼을 통해 INSERT 요청을 다시 시도할 수 있다. |
| 3    | 3a. DB 삽입은 성공했으나 SELECT 주기보다 빠르게 UI가 갱신되지 않는다.<br>- 3a1. 다음 조회 주기 시 최신 메시지가 동기화된다.                                         |
| 4    | 4a. 다른 사용자가 메시지를 보냈을 경우<br>- 4a1. 시스템이 주기적 SELECT 시 해당 메시지를 감지하고 대화 목록에 추가한다.                                             |

## 10.4 RELATED INFORMATION

10.4.1 Performance : ≤ 2 seconds (DB 쓰기 및 주기적 읽기 포함 반영까지)

10.4.2 Frequency

- 채팅 세션 중 메시지 입력 시마다 발생

  10.4.3 Concurrency : 다수의 사용자가 동시에 메시지를 저장할 수 있으며, DB는 created_at 기준으로 순서가 보장된다.

  10.4.4 Due Date : None

# Use case 11. 기존 내역 불러오기

## 11.1 GENERAL CHARACTERISTICS

11.1.1 Summary : 사용자가 채팅방에 재접속했을 때 과거 메시지를 불러와 확인할 수 있다.

11.1.2 Scope : None

11.1.3 Level : user level

11.1.4 Author : 김도림

11.1.5 Last Update : None

11.1.6 Status : Analysis

11.1.7 Primary Actor : User(logined)

11.1.8 Preconditions

- 로그인 상태이며, 유효한 채팅방(room_id)에 입장한 상태여야 한다.
- chat_message 테이블에 해당 채팅방의 메시지 데이터가 존재해야 한다.

  11.1.9 Trigger

- 사용자가 채팅방에 재입장하거나 스크롤을 올려 과거 메시지를 요청한다.

  11.1.10 Success Post Conditions

- 최근 메시지부터 일정 개수의 메시지가 화면에 표시된다.
- 사용자가 스크롤 또는 추가 요청 시, 더 오래된 메시지가 순차적으로 로드된다.

  11.1.11 Failure Post Conditions

- 네트워크 또는 DB 조회 오류로 인해 메시지를 불러오지 못하면 오류 안내가 표시된다.

## 11.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                                   |
| ---- | -------------------------------------------------------------------------------------------------------- |
| S    | 사용자가 채팅방에 입장한다.                                                                              |
| 1    | 시스템이 chat_message 테이블에서 해당 room_id의 최신 N개 메시지를 조회한다.                              |
| 2    | 조회된 메시지를 created_at 기준 오름차순으로 정렬한다.                                                   |
| 3    | 정렬된 메시지를 화면에 표시한다.                                                                         |
| 4    | 사용자가 상단으로 스크롤하거나 "이전 메시지 보기"를 요청하면, 시스템이 더 오래된 메시지를 추가 조회한다. |
| 5    | 새로 불러온 메시지는 기존 목록의 앞쪽에 병합되어 시간순으로 표시된다.                                    |

## 11.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                      |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 네트워크 또는 DB 연결 오류 발생<br>- 1a1. 시스템이 오류를 감지하고 "전송 실패" 안내를 표시한다.<br>- 1a2. 재시도 버튼을 제공한다. |
| 4    | 4a. 더 이상 과거 메시지가 없음<br>- 4a1. "더 이상 불러올 메시지가 없습니다." 안내 문구를 표시한다.                                    |
| 5    | 5a. 다른 사용자가 메시지를 보냈을 경우<br>- 5a1. 시스템이 주기적 SELECT 시 해당 메시지를 감지하고 대화 목록에 추가한다.               |

## 11.4 RELATED INFORMATION

11.4.1 Performance : ≤ 1 seconds

11.4.2 Frequency

- 채팅방 입장 시 1회 자동 호출 + 사용자 요청 시 추가 호출

  11.4.3 Concurrency

- 여러 사용자가 동시에 조회하더라도 읽기 전용 쿼리이므로 DB 락 없음.
- 메시지는 created_at 및 message_id 기준으로 정렬 일관성 유지.

  11.4.4 Due Date : None

# Use case 12. 읽음 처리

## 12.1 GENERAL CHARACTERISTICS

12.1.1 Summary : 사용자가 읽은 메시지를 표시하고, 상대방도 이를 확인할 수 있다.

12.1.2 Scope : None

12.1.3 Level : user level

12.1.4 Author : 김도림

12.1.5 Last Update : None

12.1.6 Status : Analysis

12.1.7 Primary Actor : User(logined)

12.1.8 Preconditions

- 로그인 상태이며, 유효한 채팅방(room_id)에 입장한 상태여야 한다.
- chat_message 테이블에 해당 채팅방의 메시지 데이터가 존재해야 한다.

  12.1.9 Trigger

- 사용자가 채팅방에서 메시지를 열람하거나 "모두 읽음"을 실행한다.

  12.1.10 Success Post Conditions

- 열람한 메시지가 읽음 상태로 표시된다.
- 상대방(들)도 해당 메시지의 읽음 여부를 확인할 수 있다.
- 채팅방 목록/알림에서 미확인 메시지 개수가 갱신된다.

  12.1.11 Failure Post Conditions

- 읽음 상태 갱신 실패 시 UI에 실패 안내가 표시되고, 다음 동기화 시 재시도한다.

## 12.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                        |
| ---- | --------------------------------------------------------------------------------------------- |
| S    | 사용자가 채팅방 화면을 연다(또는 특정 메시지까지 스크롤한다).                                 |
| 1    | 시스템이 사용자가 화면에서 확인한 마지막 메시지 ID를 계산한다(뷰포트 내 최하단 확인 기준 등). |
| 2    | 시스템이 chat_message에 읽음 플래그를 업데이트한다.                                           |
| 3    | 시스템이 현재 사용자의 미확인 메시지 수를 0 또는 감소치로 갱신한다.                           |
| 4    | 상대방이 이후 조회할 때, 읽음 상태가 반영된 메시지 메타데이터를 수신한다.                     |
| 5    | 사용자가 "모두 읽음" 실행 시, 현재 시점 기준 최신 메시지까지 일괄 업데이트한다.               |

## 12.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                           |
| ---- | -------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 네트워크 또는 DB 연결 오류 발생<br>- 1a1. 로컬에 마지막 읽음 포인터를 보관하고, 연결 복구 시 재전송한다.               |
| 2    | 2a. 중복/과거 포인터 보고<br>- 2a1. 서버는 더 큰(더 최신) 포인터만 수용한다(id/created_at 비교).                           |
| 3    | 3a. 다중 기기 동시 사용<br>- 3a1. 가장 최신 포인터로 서버 상태를 정규화하고 클라이언트에 브로드캐스트한다(주기 조회 반영). |

## 12.4 RELATED INFORMATION

12.4.1 Performance : ≤ 1 second

12.4.2 Frequency

- 화면 진입/스크롤 시 수시 발생, "모두 읽음"은 사용자 액션 시 발생

  12.4.3 Concurrency : 동일 사용자의 다중 세션 동시 갱신 가능 — 서버는 단조 증가 규칙으로 정합성 보장

  12.4.4 Due Date : None

# Use case 13. 재접속 시 이어보기

## 13.1 GENERAL CHARACTERISTICS

13.1.1 Summary : 사용자가 채팅방에 다시 들어왔을 때 마지막으로 본 지점 이후의 메시지만 확인할 수 있다.

13.1.2 Scope : None

13.1.3 Level : user level

13.1.4 Author : 김도림

13.1.5 Last Update : None

13.1.6 Status : Analysis

13.1.7 Primary Actor : User(logined)

13.1.8 Preconditions

- 로그인 상태이며, 유효한 채팅방(room_id)에 입장한 상태여야 한다.
- 사용자별 마지막 읽음 플래그가 서버에 저장되어 있어야 한다.

  13.1.9 Trigger

- 사용자가 채팅방에 재입장한다.

  13.1.10 Success Post Conditions

- 마지막으로 읽은 메시지 이후의 새로운 메시지만 우선 표시된다.
- 불필요한 과거 내역 재조회 없이 효율적으로 대화를 이어볼 수 있다.

  13.1.11 Failure Post Conditions

- 마지막 읽음 포인터 조회 실패 시 기본(최근 N개) 로딩으로 대체하고 안내 메시지를 표시한다.

## 13.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                            |
| ---- | --------------------------------------------------------------------------------- |
| S    | 사용자가 채팅방에 재입장한다.                                                     |
| 1    | 시스템이 서버에서 사용자별 last_read_message_id(또는 last_read_at)를 조회한다.    |
| 2    | 시스템이 해당 지점 이후의 메시지를 우선 SELECT 하여 리스트에 표시한다(최신 정렬). |
| 3    | 필요 시 사용자는 과거 메시지를 추가 요청하여 스크롤로 불러올 수 있다.             |
| 4    | 표시 완료 후, 화면 노출 범위까지 자동으로 읽음 포인터를 갱신한다.                 |

## 13.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                   |
| ---- | ------------------------------------------------------------------------------------------------------------------ |
| 1    | 1a. 포인터가 존재하지 않음(최초 입장)<br>- 1a1. 최근 N개(예: 50개) 메시지를 기본으로 로드한다.                     |
| 2    | 2a. 다중 기기에서 포인터가 서로 다름<br>- 2a1. 서버 포인터를 단일 진실 소스로 사용하고 클라이언트는 이를 수용한다. |
| 3    | 3a. 네트워크/DB 오류<br>- 3a1. 최근 N개 로딩으로 폴백하고, 재시도 버튼 제공.                                       |

## 13.4 RELATED INFORMATION

13.4.1 Performance : ≤ 1 seconds

13.4.2 Frequency

- 채팅방 재입장 시마다 1회 + 추가 과거 조회 시 반복

  13.4.3 Concurrency : 읽기 위주 시나리오로 DB 락 이슈 없음. 포인터 갱신은 단조 증가로 경쟁 상태 방지.

  13.4.4 Due Date : None

# Use case 14. 회원가입

## 14.1 GENERAL CHARACTERISTICS

14.1.1 Summary : 사용자는 이메일, 비밀번호, 역할 등을 입력하여 계정을 생성한다.

14.1.2 Scope : None

14.1.3 Level : user level

14.1.4 Author : None

14.1.5 Last Update : None

14.1.6 Status : Analysis

14.1.7 Primary Actor : User(Not Login)

14.1.8 Preconditions

- 사용자가 로그인하지 않은 상태여야 한다.

  14.1.9 Trigger

- 로그인 화면에서 회원가입 버튼을 누를 때.

  14.1.10 Success Post Conditions

- 로그인 페이지로 이동한다.
- 사용자는 로그인을 할 수 있다.

  14.1.11 Failure Post Conditions

- 사용자는 로그인을 할 수 없다.
- 사용자는 시스템을 이용할 수 없다.

## 14.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                               |
| ---- | ---------------------------------------------------------------------------------------------------- |
| S    | 사용자가 회원가입 페이지에 접속한다.                                                                 |
| 1    | 사용자는 사용자 유형으로 regular, broker, admin 중에 선택한다.                                       |
| 2    | 사용자는 이메일, 사용자명, 비밀번호를 필수로 기입한다.                                               |
| 3    | 사용자는 회원 가입 시 최대 30개의 중복 불가인 태그 등록이 가능하고 없는 태그는 DB에서 자동 생성된다. |
| 4    | 시스템이 입력값을 검증한다.                                                                          |
| 5    | 회원가입 완료시 사용자가 입력한 사용자/중개사 프로필(broker일 경우)/태그를 저장한다.                 |
| 6    | 시스템이 로그인 페이지로 이동시킨다.                                                                 |

## 14.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                           |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. broker 선택 시<br>- 1a1. licenseNumber를 필수로 기입하고 agencyName은 선택적으로 기입한다. 시스템은 이를 확인한다.                                                                                                     |
| 4    | 4a. 이메일, 사용자명, 비밀번호(8~64자)의 입력값 검증 실패<br>- 4a1. 시스템이 사용자에게 오류 메시지를 보여준다.<br><br>4b. 이미 등록된 이메일인 경우<br>- 4b1. 시스템은 "이미 등록된 이메일입니다" 오류 메시지를 보여준다. |

## 14.4 RELATED INFORMATION

14.4.1 Performance : < 3sec

14.4.2 Frequency

- 사용자당 최초 1번

  14.4.3 Concurrency : 제한 없음

  14.4.4 Due Date : None

# Use case 15. 로그인 / 토큰 관리

## 15.1 GENERAL CHARACTERISTICS

15.1.1 Summary : 사용자가 시스템의 기능을 이용하기 위해 로그인을 하고 시스템은 이를 토큰 관리를 통해 유지 및 차단하는 기능.

15.1.2 Scope : None

15.1.3 Level : user level

15.1.4 Author : None

15.1.5 Last Update : None

15.1.6 Status : Analysis

15.1.7 Primary Actor : User(Not login)

15.1.8 Preconditions

- 회원가입이 이미 완료된 상태여야 한다.

  15.1.9 Trigger

- 사용자가 로그인 페이지에서 이메일과 비밀번호를 입력한 후 로그인 버튼을 누를 때.

  15.1.10 Success Post Conditions

- 사용자는 시스템의 기능들을 사용 가능하다
- AccessToken(JWT)와 RefreshToken이 발급된다.

  15.1.11 Failure Post Conditions

- 사용자는 로그인 페이지에 머물러 있다.
- 오류 메시지가 표시된다.

## 15.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                              |
| ---- | ----------------------------------------------------------------------------------- |
| S    | 사용자가 로그인 페이지에서 이메일과 비밀번호를 입력한다.                            |
| 1    | 사용자가 로그인 버튼을 클릭한다.                                                    |
| 2    | 시스템은 이메일과 비밀번호를 검증한다.                                              |
| 3    | 시스템은 로그인 성공시 AccessToken(JWT)와 RefreshToken을 발급한다.                  |
| 4    | 시스템은 RefreshToken 만료일을 14일과 30일 중에 결정한다.                           |
| 5    | 시스템은 사용자의 역할에 따라 분기된 메인 페이지를 보여준다.                        |
| 6    | AccessToken 만료시 사용자는 RefreshToken을 이용해 새로운 AccessToken 재발급 받는다. |

## 15.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                           |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 2    | 2a. 이메일이나 비밀번호가 잘못되어 로그인에 실패한다.<br>- 2a1. 로그인 실패시 에러 메시지를 보여준다.<br>- 2a2. 이메일과 비밀번호를 다시 입력 받는다.                                      |
| 6    | 6a. 만료/폐기된 RefreshToken을 사용할때 AccessToken재발급이 불가능하다.<br>- 6a1. 토큰이 만료 되었다는 오류 메시지를 보여준다.<br>- 6a2. 로그인 페이지로 이동하여 새로 로그인 하도록 한다. |

## 15.4 RELATED INFORMATION

15.4.1 Performance : < 4sec

15.4.2 Frequency

- 사용자가 로그인할 때마다

  15.4.3 Concurrency : 제한 없음

  15.4.4 Due Date : None

# Use case 16. 로그아웃

## 16.1 GENERAL CHARACTERISTICS

16.1.1 Summary : 사용자가 로그아웃을 요청하는 기능.

16.1.2 Scope : None

16.1.3 Level : user level

16.1.4 Author : None

16.1.5 Last Update : None

16.1.6 Status : Analysis

16.1.7 Primary Actor : User(logined)

16.1.8 Preconditions

- 사용자는 로그인 상태여야 한다.
- 시스템에 토큰이 저장되어 있어야 한다.

  16.1.9 Trigger

- 사용자가 로그아웃 버튼을 눌렀을 때.

  16.1.10 Success Post Conditions

- 로그인 페이지로 이동한다.
- 시스템에서 토큰을 삭제한다.
- 사용자는 재인증 없이는 API요청이 불가능하다.

  16.1.11 Failure Post Conditions

- 현 페이지 그대로 유지된다.
- 오류 메시지가 표시된다.

## 16.2 MAIN SUCCESS SCENARIO

| Step | Action                                                         |
| ---- | -------------------------------------------------------------- |
| S    | 사용자가 로그아웃 버튼을 클릭한다.                             |
| 1    | 시스템은 RefreshToken을 revoked 처리하여 무효화한다.           |
| 2    | 브라우저 쿠키와 LocalStorage/SessionStorage의 토큰을 삭제한다. |
| 3    | 시스템이 로그인 페이지로 이동시킨다.                           |

## 16.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                    |
| ---- | --------------------------------------------------------------------------------------------------- |
| 1    | 1a. Token이 이미 만료/폐기 되었을 경우<br>- 1a1. 이미 처리된 것으로 간주해서 2번 step으로 이동한다. |

## 16.4 RELATED INFORMATION

16.4.1 Performance : < 3sec

16.4.2 Frequency

- 사용자가 로그아웃할 때마다

  16.4.3 Concurrency : 제한 없음

  16.4.4 Due Date : None

# Use case 17. 비밀번호 재설정

## 17.1 GENERAL CHARACTERISTICS

17.1.1 Summary : 사용자가 비밀번호 분실 시 재설정 하는 기능.

17.1.2 Scope : None

17.1.3 Level : user level

17.1.4 Author : None

17.1.5 Last Update : None

17.1.6 Status : Analysis

17.1.7 Primary Actor : User(Not login)

17.1.8 Preconditions

- 회원가입이 완료된 상태여야 한다.

  17.1.9 Trigger

- 로그인 페이지에서 비밀번호 찾기를 누를 때.

  17.1.10 Success Post Conditions

- 로그인 페이지로 이동되며 재설정된 비밀번호로 로그인이 가능하다.
- 기존 PasswordResetToken은 만료 처리된다.

  17.1.11 Failure Post Conditions

- 사용자는 비밀번호 재설정 화면에 머물러 있다.
- 오류 메시지가 표시된다.

## 17.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                       |
| ---- | -------------------------------------------------------------------------------------------- |
| S    | 사용자가 로그인 페이지에서 비밀번호 찾기 버튼을 클릭한다.                                    |
| 1    | 사용자가 이메일 주소를 입력한다.                                                             |
| 2    | 시스템이 PasswordResetToken을 발급한다. 이는 1시간동안 유효하고 만료 시 재사용이 불가능하다. |
| 3    | 시스템이 비밀번호 재설정 링크가 담긴 이메일을 사용자에게 발송한다.                           |
| 4    | 사용자는 메일 링크를 클릭하여 비밀번호 재설정 화면으로 이동한다.                             |
| 5    | 사용자는 새 비밀번호를 입력한다.                                                             |
| 6    | 시스템은 토큰 유효성 검증 후 비밀번호 유효성을 검증한다.                                     |
| 7    | 시스템이 비밀번호를 업데이트하고 로그인 페이지로 이동시킨다.                                 |

## 17.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                                      |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2    | 2a. 입력한 이메일이 등록되지 않은 경우<br>- 2a1. 보안상 이유로 "비밀번호 재설정 링크가 발송되었습니다" 메시지를 표시하지만 실제로는 이메일을 발송하지 않는다.                                                                                                                                                         |
| 6    | 6a. 토큰이 유효하지 않은 경우<br>- 6a1. "유효하지 않거나 만료된 링크입니다" 오류 메시지를 보여준다.<br><br>6b. 비밀번호가 8~64자가 아닌 경우<br>- 6b1. "비밀번호는 8~64자여야 합니다" 오류 메시지를 보여준다.<br><br>6c. 기존과 동일한 비밀번호인 경우<br>- 6c1. "기존 비밀번호와 동일합니다" 오류 메시지를 보여준다. |

## 17.4 RELATED INFORMATION

17.4.1 Performance : < 5sec

17.4.2 Frequency

- 사용자가 비밀번호를 잊었을 때

  17.4.3 Concurrency : 제한 없음

  17.4.4 Due Date : None

# Use case 18. 사용자 프로필 관리

## 18.1 GENERAL CHARACTERISTICS

18.1.1 Summary : 사용자가 자신의 프로필 정보를 조회하고 수정하는 기능.

18.1.2 Scope : None

18.1.3 Level : user level

18.1.4 Author : None

18.1.5 Last Update : None

18.1.6 Status : Analysis

18.1.7 Primary Actor : User(logined)

18.1.8 Preconditions

- 로그인 상태여야 한다.
- 회원 가입 시에 프로필 정보를 입력한 상태여야 한다.

  18.1.9 Trigger

- 프로필 버튼을 눌러 프로필 패널을 띄울 때.

  18.1.10 Success Post Conditions

- 프로필 패널에 사용자 프로필 정보가 나타난다.
- 프로필 수정 시 변경사항이 데이터베이스에 저장된다.

  18.1.11 Failure Post Conditions

- 프로필 패널이 열리지 않거나 정보가 나타나지 않는다.
- 오류 메시지가 표시된다.

## 18.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                           |
| ---- | -------------------------------------------------------------------------------- |
| S    | 사용자가 프로필 버튼을 클릭한다.                                                 |
| 1    | 시스템이 프로필 패널을 연다.                                                     |
| 2    | 시스템이 이메일, 닉네임, 역할, 전화번호, 소개글, 사진, 태그를 조회하여 표시한다. |

## 18.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2    | 2a. broker 계정인 경우<br>- 2a1. licenseNumber, agencyName, intro, profileImageUrl을 같이 포함하여 표시한다.<br><br>2b. 프로필 수정 버튼을 누른 경우<br>- 2b1. 사용자는 현재 비밀번호를 입력해야 한다.<br>- 2b2. 프로필 태그, 사진, 비밀번호, 프로필 소개문을 수정 가능하다.<br>- 2b3. 시스템은 사용자가 태그 수정시 전체 삭제 후 재등록한다.(최대 30개, 중복불가, 없으면 DB를 생성한다)<br>- 2b4. 비밀번호 변경 시에는 기존 비밀번호 검증 및 동일 여부를 확인한다.<br>- 2b5. 시스템은 비밀번호 변경 성공시 새로운 해시로 저장한다. |

## 18.4 RELATED INFORMATION

18.4.1 Performance : < 5sec

18.4.2 Frequency

- 사용자가 프로필을 조회하거나 수정할 때마다

  18.4.3 Concurrency : 제한 없음

  18.4.4 Due Date : None

# Use case 19. 매물 목록 조회 (전체)

## 19.1 GENERAL CHARACTERISTICS

19.1.1 Summary : 사용자가 등록된 매물을 전체 목록으로 확인한다.

19.1.2 Scope : None

19.1.3 Level : user level

19.1.4 Author : 김도림

19.1.5 Last Update : None

19.1.6 Status : Analysis

19.1.7 Primary Actor : User(logined)

19.1.8 Preconditions

- 사용자는 로그인 상태여야 한다.

  19.1.9 Trigger

- 사용자가 "전체 매물 보기" 메뉴를 선택한다.

  19.1.10 Success Post Conditions

- 전체 매물 목록이 페이지 단위로 표시된다.
- 기본 정렬은 최신순이며, 상태·유형·가격·지역 기준으로 필터링이 가능하다.

  19.1.11 Failure Post Conditions

- 서버 또는 네트워크 오류로 조회 실패 시 오류 메시지가 표시된다.

## 19.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                               |
| ---- | ------------------------------------------------------------------------------------ |
| S    | 사용자가 "전체 매물 보기" 메뉴를 선택한다.                                           |
| 1    | 시스템이 로그인 토큰을 확인한다.                                                     |
| 2    | 시스템이 property 테이블에서 매물 목록을 페이지 단위로 조회한다.                     |
| 3    | 결과를 최신순으로 정렬하여 화면에 표시한다.                                          |
| 4    | 사용자가 필터(상태, 유형, 가격, 지역 등)를 지정하면 시스템이 조건에 맞게 재조회한다. |

## 19.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                           |
| ---- | ---------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 로그인 상태가 아님<br>- 1a1. 시스템이 로그인 화면으로 이동시키고 인증 후 재시도하도록 안내한다.        |
| 2    | 2a. 네트워크 또는 DB 오류<br>- 2a1. "목록을 불러올 수 없습니다." 메시지를 표시하고 재시도 버튼을 제공한다. |
| 4    | 4a. 필터 조건에 해당하는 매물이 없음<br>- 4a1. "조건에 맞는 매물이 없습니다." 안내 문구를 표시한다.        |

## 19.4 RELATED INFORMATION

19.4.1 Performance : ≤ 1.5 seconds

19.4.2 Frequency

- 사용자 탐색 시마다 발생

  19.4.3 Concurrency : 다수의 사용자가 동시에 조회 가능

  19.4.4 Due Date : None

# Use case 20. 내 매물 관리

## 20.1 GENERAL CHARACTERISTICS

20.1.1 Summary : 사용자가 본인이 등록한 매물을 따로 확인하고 관리한다.

20.1.2 Scope : None

20.1.3 Level : user level

20.1.4 Author : 김도림

20.1.5 Last Update : None

20.1.6 Status : Analysis

20.1.7 Primary Actor : Owner(logined) or intermediary

20.1.8 Preconditions

- 로그인 상태이며, 사용자 ID와 매물의 등록자 ID가 일치해야 한다.

  20.1.9 Trigger

- 사용자가 "내 매물" 메뉴를 선택한다.

  20.1.10 Success Post Conditions

- 본인 등록 매물 목록이 표시된다.
- 매물 상태 변경 또는 정보 수정이 가능하다.

  20.1.11 Failure Post Conditions

- 서버 오류 또는 권한 불일치 시 수정/조회 실패.
- 오류 메시지가 표시된다.

## 20.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                         |
| ---- | ------------------------------------------------------------------------------ |
| S    | 사용자가 "내 매물" 메뉴를 선택한다.                                            |
| 1    | 시스템이 로그인 사용자의 user_id를 확인한다.                                   |
| 2    | 시스템이 property 테이블에서 owner_id = user_id 조건으로 매물 목록을 조회한다. |
| 3    | 조회 결과를 화면에 표시하고, 필터와 정렬 기능을 동일하게 제공한다.             |
| 4    | 사용자가 매물 상태 변경 또는 수정 요청 시 시스템이 해당 항목을 업데이트한다.   |
| 5    | 성공 시 "저장되었습니다." 안내 메시지를 표시한다.                              |

## 20.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                             |
| ---- | -------------------------------------------------------------------------------------------- |
| 1    | 1a. 로그인 상태가 아님<br>- 1a1. 로그인 페이지로 이동 후 인증 완료 시 메뉴 재로드한다.       |
| 2    | 2a. 네트워크 또는 DB 오류<br>- 2a1. "내 매물을 불러올 수 없습니다." 안내 후 재시도 제공한다. |
| 4    | 4a. 매물 수정 중 권한 불일치<br>- 4a1. "수정 권한이 없습니다." 안내 표시한다.                |

## 20.4 RELATED INFORMATION

20.4.1 Performance : ≤ 1.5 seconds

20.4.2 Frequency

- 사용자가 자신의 매물을 확인할 때마다

  20.4.3 Concurrency : 동일 사용자의 다중 요청 발생 가능

  20.4.4 Due Date : None

# Use case 21. 타인 매물 조회

## 21.1 GENERAL CHARACTERISTICS

21.1.1 Summary : 사용자가 다른 소유자가 등록한 매물만 확인한다.

21.1.2 Scope : None

21.1.3 Level : user level

21.1.4 Author : 김도림

21.1.5 Last Update : None

21.1.6 Status : Analysis

21.1.7 Primary Actor : User(logined)

21.1.8 Preconditions

- 로그인 상태이며, property.owner_id ≠ user_id 조건이 적용되어야 한다.

  21.1.9 Trigger

- 사용자가 "다른 소유자 매물 보기" 메뉴를 선택한다.

  21.1.10 Success Post Conditions

- 자신이 등록하지 않은 매물 목록이 표시된다.
- 매물의 기본 정보와 거래 조건을 열람할 수 있다.

  21.1.11 Failure Post Conditions

- 조회 실패 시 오류 메시지가 표시된다.

## 21.2 MAIN SUCCESS SCENARIO

| Step | Action                                                              |
| ---- | ------------------------------------------------------------------- |
| S    | 사용자가 "다른 소유자 매물 보기" 메뉴를 선택한다.                   |
| 1    | 시스템이 로그인 사용자의 user_id를 확인한다.                        |
| 2    | 시스템이 property 테이블에서 owner_id != user_id 조건으로 조회한다. |
| 3    | 조회 결과를 최신순으로 정렬하여 화면에 표시한다.                    |
| 4    | 사용자는 매물 상세 정보를 열람할 수 있다.                           |

## 21.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                          |
| ---- | ----------------------------------------------------------------------------------------- |
| 1    | 1a. 로그인 상태가 아님<br>- 1a1. 로그인 후 다시 메뉴 접근하도록 안내한다.                 |
| 2    | 2a. 네트워크 또는 DB 오류<br>- 2a1. "매물을 불러올 수 없습니다." 안내 후 재시도 제공한다. |

## 21.4 RELATED INFORMATION

21.4.1 Performance : ≤ 1.5 seconds

21.4.2 Frequency

- 사용자가 다른 소유자의 매물을 확인할 때마다

  21.4.3 Concurrency : 다수의 사용자가 동시에 조회 가능

  21.4.4 Due Date : None

# Use case 22. 매물 상세 조회

## 22.1 GENERAL CHARACTERISTICS

22.1.1 Summary : 사용자가 특정 매물의 세부 정보를 확인한다.

22.1.2 Scope : None

22.1.3 Level : user level

22.1.4 Author : 김도림

22.1.5 Last Update : None

22.1.6 Status : Analysis

22.1.7 Primary Actor : User(logined)

22.1.8 Preconditions

- 로그인 상태이며, 매물이 유효한 property_id를 가지고 있어야 한다.

  22.1.9 Trigger

- 사용자가 매물 목록에서 특정 매물을 선택한다.

  22.1.10 Success Post Conditions

- 매물의 세부 정보(제목, 주소, 가격, 면적, 건축년도, 상태 등)가 표시된다.
- 거래 조건(매매/전세/월세, 보증금, 관리비 등)과 이미지가 함께 표시된다.

  22.1.11 Failure Post Conditions

- 매물 정보 조회 실패 시 오류 안내가 표시된다.

## 22.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                           |
| ---- | -------------------------------------------------------------------------------- |
| S    | 사용자가 매물 목록에서 특정 매물을 선택한다.                                     |
| 1    | 시스템이 선택된 property_id를 확인한다.                                          |
| 2    | 시스템이 property, property_offers, property_images 테이블을 조회한다.           |
| 3    | 조회된 데이터를 통합하여 상세 화면에 표시한다.                                   |
| 4    | 사용자는 상세 정보를 열람하고, 필요 시 채팅 또는 즐겨찾기 기능을 사용할 수 있다. |

## 22.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                              |
| ---- | --------------------------------------------------------------------------------------------- |
| 1    | 1a. 잘못된 property_id<br>- 1a1. "존재하지 않는 매물입니다." 메시지를 표시하고 목록으로 복귀. |
| 2    | 2a. 네트워크 및 DB 연결 오류<br>- 2a1. "매물 정보를 불러올 수 없습니다." 안내 표시.           |
| 3    | 3a. 이미지나 추가 정보 누락<br>- 3a1. 누락된 항목은 빈 영역 또는 대체 문구로 표시한다.        |

## 22.4 RELATED INFORMATION

22.4.1 Performance : ≤ 1.5 seconds

22.4.2 Frequency

- 매물 상세 페이지 진입 시마다 1회

  22.4.3 Concurrency : 다수의 사용자가 동시에 조회 가능

  22.4.4 Due Date : None

# Use case 23. 위임 관리

## 23.1 GENERAL CHARACTERISTICS

23.1.1 Summary : 매물 소유자가 브로커에게 판매 위임을 요청하고, 브로커가 이를 승인·거절·취소·삭제할 수 있는 기능.

23.1.2 Scope : None

23.1.3 Level : user level

23.1.4 Author : None

23.1.5 Last Update : None

23.1.6 Status : Analysis

23.1.7 Primary Actor : Owner

23.1.8 Secondary Actor : Broker

23.1.9 Preconditions

- 소유자는 로그인 상태이며 본인 소유 매물이 존재해야 한다.
- 브로커는 실제 프로필이 등록되어 있어야 한다.

  23.1.10 Trigger

- 소유자가 위임 요청을 생성하거나 브로커가 요청을 처리할 때.

  23.1.11 Success Post Conditions

- 위임 요청이 생성·승인·거절·취소·삭제되고 매물 상태가 일관되게 반영된다.

  23.1.12 Failure Post Conditions

- 요청 또는 상태 변경이 반영되지 않는다.
- 오류 메시지가 표시된다.

## 23.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                            |
| ---- | --------------------------------------------------------------------------------- |
| S    | 소유자가 본인 매물 상세 화면에서 '브로커 위임 요청' 버튼을 클릭한다.              |
| 1    | 소유자가 브로커를 선택하고 거래 유형(매매/전세/월세)에 맞게 필수 금액을 입력한다. |
| 2    | 시스템은 동일 매물에 PENDING 요청이 존재하는지 확인한다.                          |
| 3    | 시스템이 유효한 브로커인지 확인 후 위임 요청을 PENDING 상태로 생성한다.           |
| 4    | 브로커는 자신에게 도착한 요청 목록을 확인한다.                                    |
| 5    | 브로커는 개별 요청을 승인하거나 거절 사유를 입력해 거절한다.                      |
| 6    | 승인 시 매물이 공개 매물 목록에 등록된다.                                         |
| 7    | 소유자는 본인이 보낸 요청 내역을 확인하고 대기 중인 요청은 취소할 수 있다.        |
| 8    | 소유자는 승인된 요청을 제외한 대기/거절/취소 요청을 삭제할 수 있다.               |

## 23.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                |
| ---- | --------------------------------------------------------------------------------------------------------------- |
| 2    | 2a. 동일 매물에 PENDING 요청 존재<br>- 2a1. 새 요청 생성을 차단하고 "이미 요청이 존재합니다" 메시지를 표시한다. |
| 3    | 3a. 브로커가 유효하지 않은 경우<br>- 3a1. 시스템이 요청 생성을 거부한다.                                        |
| 5    | 5a. 이미 처리된 요청을 다시 처리 시도<br>- 5a1. 승인/거절 동작이 차단된다.                                      |
| 8    | 8a. 승인된 요청을 삭제 시도<br>- 8a1. 시스템이 삭제를 차단하고 안내 메시지를 표시한다.                          |

## 23.4 RELATED INFORMATION

23.4.1 Performance : ≤ 1 second

23.4.2 Frequency

- 제한 없음

  23.4.3 Concurrency : 제한 없음

  23.4.4 Due Date : None

# Use Case 24. 알림 기능

## 24.1 GENERAL CHARACTERISTICS

24.1.1 Summary
시스템은 즐겨찾기 매물 상태 변화, 추천 매물, 예산 도달, 계약서 승인, 거래 완료 등 다양한 이벤트 발생 시 사용자에게 알림을 자동 전송하며, 사용자는 알림함을 통해 이를 확인·관리한다.

24.1.2 Scope
None

24.1.3 Level
User level

24.1.4 Author
None

24.1.5 Last Update
None

24.1.6 Status
Analysis

24.1.7 Primary Actor
User

24.1.8 Secondary Actors
System, Admin, Broker

24.1.9 Preconditions
- 사용자는 로그인 상태여야 한다.
- 알림 수신이 허용된 사용자여야 한다.
- 사용자 계정은 정상 상태여야 한다.

24.1.10 Trigger
아래와 같은 이벤트가 발생했을 때 알림이 생성된다.

- 즐겨찾기 매물 거래 완료  
- 즐겨찾기 매물 가격 하락  
- 조건 만족한 추천 매물 등록  
- 설정 예산 범위에 해당하는 매물 등록(예산 도달)  
- 관리자의 계약서 검토 완료(승인)  
- 구매 중인 매물의 거래 완료 처리(구매 완료)

24.1.11 Success Post Conditions
- 알림이 정상적으로 생성되어 사용자 알림함에 최신순으로 표시된다.
- 사용자는 알림을 읽음/삭제로 관리할 수 있다.
- 알림을 통해 관련 화면(매물 상세, 추천 매물 리스트 등)으로 이동할 수 있다.

24.1.12 Failure Post Conditions
- 알림 생성 또는 동기화에 실패할 수 있다.
- 오류 메시지가 사용자에게 표시된다.
- 서버 로그에 실패 원인이 기록된다.

---

## 24.2 MAIN SUCCESS SCENARIO

| Step | Action |
|------|--------|
| S    | 시스템이 조건 충족 이벤트(거래 완료, 가격 하락, 추천 매물 등)를 감지한다. |
| 1    | 시스템이 해당 이벤트에 맞는 알림 객체를 생성한다. |
| 2    | 시스템이 알림을 사용자 계정에 전송하고 알림함에 저장한다. |
| 3    | 사용자는 사이드바의 알림 아이콘을 눌러 알림함을 연다. |
| 4    | 시스템은 알림 목록을 최신순으로 로드한다. |
| 5    | 사용자는 알림을 읽음 처리하거나 삭제할 수 있다. |
| 6    | 사용자는 알림을 선택하여 매물 상세·추천 매물 리스트 등 관련 화면으로 이동한다. |

---

## 24.3 EXTENSION SCENARIOS

| Step | Branching Action |
|------|------------------|
| 2 | **2a. 네트워크 오류로 알림 저장 또는 전송 실패**<br> - 2a1. 시스템은 내부 재시도 정책을 적용한다.<br> - 2a2. 실패 시 서버 로그에 기록하고 사용자에게 오류 안내를 표시한다. |
| 4 | **4a. 알림 목록 로드 실패**<br> - 4a1. 시스템은 캐시된 알림을 우선 표시한다.<br> - 4a2. 화면 상단에 ‘동기화 실패’ 메시지를 출력한다. |
| 5 | **5a. 일부 알림 상태(읽음/삭제) 업데이트 실패**<br> - 5a1. 성공한 항목만 반영하고, 실패 항목은 사용자에게 별도 안내 메시지를 표시한다. |

---

## 24.4 RELATED INFORMATION

24.4.1 Performance
알림 생성·전송·조회는 ≤ 1초 이내 처리되어야 한다.

24.4.2 Frequency
제한 없음 — 이벤트 발생 횟수 및 사용자 활동에 따라 자동 발생.

24.4.3 Concurrency
사용자 수와 관계없이 동시 처리 지원.

24.4.4 Due Date
None


# Use case 25. 지도 매물 시각화

## 25.1 GENERAL CHARACTERISTICS

25.1.1 Summary : 사용자의 지도 화면에 매물 위치를 아이콘으로 표시한다.

25.1.2 Scope : None

25.1.3 Level : user level

25.1.4 Author : None

25.1.5 Last Update : None

25.1.6 Status : Analysis

25.1.7 Primary Actor : User(logined)

25.1.8 Preconditions

- 로그인을 한 상태여야 한다.

  25.1.9 Trigger

- 지도 화면 최초 진입, 또는 줌/팬 등 뷰포트 변경 이벤트 발생.

  25.1.10 Success Post Conditions

- 지도에 현재 뷰포트 내 매물이 상태별 컬러 마커로 표시된다.
- 매물 선택 시 요약 패널/시트에 상세 정보가 로드된다.

  25.1.11 Failure Post Conditions

- 지도에 매물 띄우기를 실패한다.
- 오류 메시지가 표시된다.

## 25.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                                                        |
| ---- | ----------------------------------------------------------------------------------------------------------------------------- |
| S    | 사용자가 지도 화면에 진입한다.                                                                                                |
| 1    | 시스템이 네이버 지도 API를 이용하여 지도를 렌더링한다.                                                                        |
| 2    | 시스템이 현재 지도 뷰포트(BBOX: south, west, north, east)와 필터(상태, 가격 범위 등)를 읽는다.                                |
| 3    | 시스템이 데이터베이스에서 매물 목록을 조회한다. (BBOX + 상태 필터, 페이지네이션)                                              |
| 4    | 시스템이 결과를 상태별 컬러 규칙에 따라 마커/클러스터로 렌더링한다. (available/pending/sold)                                  |
| 5    | 사용자가 마커를 클릭하면 시스템이 properties, property_images, property_offers에서 상세를 조회하여 하단 시트/카드에 표시한다. |
| 6    | 사용자가 지도를 줌/팬하면 시스템이 범위를 재조회하고 마커를 갱신한다.                                                         |

## 25.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                   |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 지도 API 호출 실패<br>- 1a1. 재시도를 수행하고 오류 메시지를 출력한다.                                                         |
| 2    | 2a. 로그인 토큰이 없거나 유효하지 않은 경우<br>- 2a1. "로그인이 필요합니다" 메시지를 출력한다.<br>- 2a2. 로그인 페이지로 이동한다. |
| 3    | 3a. 네트워크 또는 DB 조회 실패<br>- 3a1. 캐시된 데이터를 표시하고 "데이터를 불러올 수 없습니다" 메시지를 표시한다.                 |

## 25.4 RELATED INFORMATION

25.4.1 Performance : ≤ 1 second

25.4.2 Frequency

- 지도를 호출할 때마다

  25.4.3 Concurrency : 제한 없음

  25.4.4 Due Date : None

# Use case 26. 사용자 위치 표시

## 26.1 GENERAL CHARACTERISTICS

26.1.1 Summary : 사용자의 현재 위치를 지도에 표시한다.

26.1.2 Scope : None

26.1.3 Level : user level

26.1.4 Author : None

26.1.5 Last Update : None

26.1.6 Status : Analysis

26.1.7 Primary Actor : User(logined)

26.1.8 Preconditions

- 사용자가 위치 권한을 허용한 상태여야 한다.

  26.1.9 Trigger

- 지도 화면이 처음 호출되거나 '현재 위치' 버튼을 클릭했을 때.

  26.1.10 Success Post Conditions

- 사용자의 현재 위치를 지도 중심으로 표시한다.
- 위치 정보 획득이 실패하면 기본 위치(시청)를 중심으로 설정한다.

  26.1.11 Failure Post Conditions

- GPS 신호 또는 권한 획득 실패 시 기본 중심(시청)으로 설정된다.

## 26.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                    |
| ---- | ------------------------------------------------------------------------- |
| S    | 사용자가 지도 화면에 진입하거나 '현재 위치' 버튼을 클릭한다.              |
| 1    | 시스템이 위치 권한 상태를 확인한다.                                       |
| 2    | 권한이 허용되어 있으면 현재 GPS 좌표를 획득한다.                          |
| 3    | 지도 중심을 현재 위치로 이동하고 마커로 표시한다.                         |
| 4    | 사용자가 '현재 위치 고정' 버튼을 클릭하면 현재 중심 좌표를 DB에 저장한다. |

## 26.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                           |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 위치 권한이 비활성화된 경우<br>- 1a1. 권한 요청 팝업을 표시한다.<br>- 1a2. 거부 시 기본 중심(시청 좌표)으로 이동한다.                                  |
| 2    | 2a. GPS 신호를 받지 못한 경우<br>- 2a1. 마지막 저장된 사용자 위치를 불러와 중심으로 이동한다.<br>- 2a2. 마지막 위치 정보도 없을 경우 시청 좌표로 이동한다. |

## 26.4 RELATED INFORMATION

26.4.1 Performance : ≤ 1 second

26.4.2 Frequency

- 지도 진입 또는 '현재 위치' 버튼 클릭 시마다

  26.4.3 Concurrency : 제한 없음

  26.4.4 Due Date : None

# Use case 27. 지도 매물 즐겨찾기

## 27.1 GENERAL CHARACTERISTICS

27.1.1 Summary : 즐겨찾기 등록/조회/삭제 기능을 통해 사용자가 관심 매물을 관리한다.

27.1.2 Scope : None

27.1.3 Level : user level

27.1.4 Author : None

27.1.5 Last Update : None

27.1.6 Status : Analysis

27.1.7 Primary Actor : User(logined)

27.1.8 Preconditions

- 로그인되어 있어야 하며 토큰이 유효해야 한다.

  27.1.9 Trigger

- 즐겨찾기 탭 클릭 또는 매물 카드의 하트 버튼 클릭 시.

  27.1.10 Success Post Conditions

- 즐겨찾기 목록을 정상 조회하거나 등록/삭제 동작을 완료한다.

  27.1.11 Failure Post Conditions

- 네트워크 또는 인증 오류시 즐겨찾기 목록/등록이 실패한다.
- 오류 메시지가 표시된다.

## 27.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                           |
| ---- | ------------------------------------------------------------------------------------------------ |
| S    | 사용자가 즐겨찾기 탭을 클릭한다.                                                                 |
| 1    | 시스템이 현재 로그인된 사용자의 토큰을 검증한다.                                                 |
| 2    | favorites 테이블에서 해당 사용자 id와 일치하는 즐겨찾기 목록을 조회한다.                         |
| 3    | 지도에 즐겨찾기 매물들을 하트 표시된 상태로 표시한다.                                            |
| 4    | 사용자가 즐겨찾기 매물 클릭 시 지도 중심을 해당 매물 좌표로 이동시키고 상세정보 패널을 표시한다. |

## 27.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                                   |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1    | 1a. 즐겨찾기 추가<br>- 1a1. 매물의 하트 버튼 클릭 시 현재 로그인된 사용자 토큰으로 favorites 테이블에 데이터 추가한다.<br>- 1a2. 추가 후 하트 버튼이 빨간색으로 변한다.<br><br>1b. 즐겨찾기 제거<br>- 1b1. 빨간색 하트 클릭 시 favorites 테이블에서 해당 데이터를 삭제한다.<br>- 1b2. 버튼 색상이 회색으로 변한다. |
| 2    | 2a. 토큰이 유효하지 않은 경우<br>- 2a1. "로그인이 필요합니다" 메시지를 표시하고 로그인 페이지로 이동한다.                                                                                                                                                                                                          |
| 3    | 3a. 정보 조회 실패<br>- 3a1. 조회 실패 시 실패 원인을 상단 알림창에 표시한다.<br>- 3a2. 재시도 버튼 제공한다.                                                                                                                                                                                                      |

## 27.4 RELATED INFORMATION

27.4.1 Performance : ≤ 1 second

27.4.2 Frequency

- 즐겨찾기 탭 또는 버튼 클릭 시

  27.4.3 Concurrency : 제한 없음

  27.4.4 Due Date : None

# Use case 28. 매물 상세정보 표시

## 28.1 GENERAL CHARACTERISTICS

28.1.1 Summary : 마커 클릭 시 매물의 상세정보를 사이드바로 표시한다.

28.1.2 Scope : None

28.1.3 Level : user level

28.1.4 Author : None

28.1.5 Last Update : None

28.1.6 Status : Analysis

28.1.7 Primary Actor : User(logined)

28.1.8 Preconditions

- 지도에 매물 마커가 표시되어 있어야 한다.

  28.1.9 Trigger

- 사용자가 마커를 클릭했을 때.

  28.1.10 Success Post Conditions

- 매물 정보 패널이 열리고 상세 정보가 표시된다.

  28.1.11 Failure Post Conditions

- 매물 정보 조회 또는 표시 실패 시 오류 메시지를 출력한다.

## 28.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                   |
| ---- | ---------------------------------------------------------------------------------------- |
| S    | 사용자가 지도에서 마커를 클릭한다.                                                       |
| 1    | 시스템이 클릭된 마커의 property_id를 획득한다.                                           |
| 2    | 데이터베이스에서 properties, property_images, property_offers, favorite 정보를 조회한다. |
| 3    | 조회한 정보를 사이드바에 렌더링한다.                                                     |

## 28.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                       |
| ---- | ------------------------------------------------------------------------------------------------------ |
| 2    | 2a. 매물 정보 조회 실패<br>- 2a1. 실패 메시지를 표시하고 재시도 버튼을 제공한다.                       |
| 3    | 3a. 이미지 로드 실패<br>- 3a1. 대체 이미지를 표시하고 "이미지를 불러올 수 없습니다" 메시지를 표시한다. |

## 28.4 RELATED INFORMATION

28.4.1 Performance : ≤ 1 second

28.4.2 Frequency

- 마커 클릭 시마다

  28.4.3 Concurrency : 제한 없음

  28.4.4 Due Date : None

# Use case 29. 필터

## 29.1 GENERAL CHARACTERISTICS

29.1.1 Summary : 매물을 필터링한다.

29.1.2 Scope : None

29.1.3 Level : user level

29.1.4 Author : None

29.1.5 Last Update : None

29.1.6 Status : Analysis

29.1.7 Primary Actor : User(logined)

29.1.8 Preconditions

- 지도 화면과 매물 정보가 활성화되어 있어야 한다.

  29.1.9 Trigger

- 사용자가 개별 또는 종합 필터를 지정하고 적용 버튼을 클릭할 때.
- 검색창에 위치를 입력하고 확인을 누를 때.

  29.1.10 Success Post Conditions

- 필터 조건에 맞는 매물만 지도에 표시된다.
- 지도가 위치에 맞게 이동된다.

  29.1.11 Failure Post Conditions

- 필터 적용 및 이동 실패 시 오류 메시지 출력 및 필터 해제.

## 29.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                         |
| ---- | ------------------------------------------------------------------------------ |
| S    | 사용자가 필터를 지정한 후 적용 버튼을 클릭한다.                                |
| 1    | 시스템이 property_offers 및 properties 테이블에서 조건에 맞는 매물을 조회한다. |
| 2    | 결과를 지도에 표시하고 건물 상태에 따라 다른 색상으로 표시한다.                |
| 3    | 필터가 적용된 경우 필터 버튼이 파란색으로 표시된다.                            |
| 4    | 필터가 없는 경우 모든 매물을 표시한다.                                         |

## 29.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                                                                                                                                                                   |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 종합 필터 적용<br>- 1a1. 모든 조건을 한 번에 지정 후 적용 버튼 클릭 시 필터가 적용된다.<br>- 1a2. 결과 매물만 지도에 표시된다.<br><br>1b. 위치 검색<br>- 1b1. 위치를 검색한다.<br>- 1b2. 관련된 위치가 하단에 표시된다.<br>- 1b3. 위치 클릭 시 해당 위치 데이터를 받아와 지도 중심을 이동한다. |
| 2    | 2a. 필터 조회 실패<br>- 2a1. 필터 적용 실패 시 오류 메시지를 출력하고 필터가 해제된다.                                                                                                                                                                                                             |

## 29.4 RELATED INFORMATION

29.4.1 Performance : ≤ 1 second

29.4.2 Frequency

- 필터 지정 시마다

  29.4.3 Concurrency : 제한 없음

  29.4.4 Due Date : None

# Use case 30. 추천 매물

## 30.1 GENERAL CHARACTERISTICS

30.1.1 Summary : 알고리즘을 통한 사용자의 관심사와 선호도를 분석하여 개인화된 매물을 추천하는 기능

30.1.2 Scope : None

30.1.3 Level : user level

30.1.4 Author : None

30.1.5 Last Update : None

30.1.6 Status : Analysis

30.1.7 Primary Actor : User(logined)

30.1.8 Preconditions

- 로그인한 상태여야 하면 이전에 선호도를 등록해놓은 상태여야 한다.

  30.1.9 Trigger

- 사용자가 로그인 하거나 추천매물 섹션에 접근할 때.

  30.1.10 Success Post Conditions

- 개인화된 매물 리스트가 추천 섹션에 표시된다.

  30.1.11 Failure Post Conditions

- 데이터 부족 또는 알고리즘 오류 시 추천이 표시되지 않는다.

## 30.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                           |
| ---- | ------------------------------------------------------------------------------------------------ |
| S    | 사용자가 로그인한다.                                                                             |
| 1    | 사용자가 열람한 매물 수를 확인한다.                                                              |
| 2    | 매물 클릭 시 DB에 사용한 ID, 매물 ID 속성 정보를 저장한다.                                       |
| 3    | 열람 매물 수가 기준 이상이 되거나 이전에 저장해놓은 선호도가 있다면 추천 계산 트리거가 발생한다. |
| 4    | 수집 데이터의 유효성 검증 → 원-핫 인코딩/정규화 처리 → 벡터화 수행.                              |
| 5    | 전체 매물 벡터와 사용자 벡터 간 유사도를 계산한다.                                               |
| 6    | 유사도 순으로 정렬 후 추천매물 섹션에 표시한다.                                                  |
| 7    | 새 매물 클릭 시 재계산 및 재정렬 수행.                                                           |
| 8    | 일정 매물 추가 조회시 추천 계산 트리거가 재 조회된다.                                            |

## 30.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                                                                           |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 1a. 위치 권한이 비활성화된 경우<br>- 1a1. 권한 요청 팝업을 표시한다.<br>- 1a2. 거부 시 기본 중심(시청 좌표)으로 이동한다.                                  |
| 2    | 2a. GPS 신호를 받지 못한 경우<br>- 2a1. 마지막 저장된 사용자 위치를 불러와 중심으로 이동한다.<br>- 2a2. 마지막 위치 정보도 없을 경우 시청 좌표로 이동한다. |

## 30.4 RELATED INFORMATION

30.4.1 Performance : ≤ 1 second

30.4.2 Frequency

- 지도 진입 또는 '현재 위치' 버튼 클릭 시마다

  30.4.3 Concurrency : 제한없음

# Use case 31. 중개인 목록 표시

## 31.1 GENERAL CHARACTERISTICS

31.1.1 Summary : 등록된 중개인 목록과 상세 정보를 조회하고, 상세에서 연락/위임 의뢰로 연결하는 기능

31.1.2 Scope : None

31.1.3 Level : user level

31.1.4 Author : None

31.1.5 Last Update : None

31.1.6 Status : Analysis

31.1.7 Primary Actor : User(logined)

31.1.8 Preconditions

- 사용자는 로그인 상태이며 중개인 목록 조회 권한이 있어야 한다.

  31.1.9 Trigger

- 사용자가 중개인 목록 아이콘을 클릭하거나 검색을 수행할 때.

  31.1.10 Success Post Conditions

- 중개인 목록과 상세 정보가 표시되고, 연락 및 위임 의뢰가 가능하다.

  31.1.11 Failure Post Conditions

- 목록 또는 상세 정보를 불러오지 못한다.

## 31.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                                          |
| ---- | ----------------------------------------------------------------------------------------------- |
| S    | 사용자가 중개인 목록 아이콘을 클릭한다.                                                         |
| 1    | 시스템이 등록된 중개인 전체 목록을 불러온다.                                                    |
| 2    | 검색어가 없으면 전체 목록을 표시하고, 입력 시 필터링한다.                                       |
| 3    | 사용자가 특정 중개인의 상세 정보를 클릭한다.                                                    |
| 4    | 시스템이 해당 중개인의 연락처, 면허번호, 소개, 리뷰, 거래 건수를 표시한다.                      |
| 5    | 사용자는 상세의 '연락하기' 버튼으로 메시지 또는 전화 연결을 시도하거나, 위임 요청으로 이동한다. |

## 31.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                               |
| ---- | ---------------------------------------------------------------------------------------------- |
| 1    | 1a. 네트워크 오류로 목록 로드 실패<br>- 1a1. 재시도 버튼과 오류 메시지를 표시한다.             |
| 4    | 4a. 상세 정보 중 일부 누락<br>- 4a1. 이용 가능한 정보만 표시하고, 누락 데이터는 추후 갱신한다. |
| 5    | 5a. 연락 권한 미허용<br>- 5a1. 권한 요청 안내 또는 대체 연락 수단을 제공한다.                  |

## 31.4 RELATED INFORMATION

31.4.1 Performance : ≤ 1 second

31.4.2 Frequency

- 제한 없음

  31.4.3 Concurrency : 제한 없음

# Use case 32. 전세가율 계산기

## 32.1 GENERAL CHARACTERISTICS

32.1.1 Summary : 매물의 전세가율(전세가/매매가×100)을 계산하고, 주변 평균 및 AI 예측을 활용해 표시하는 기능

32.1.2 Scope : None

32.1.3 Level : user level

32.1.4 Author : None

32.1.5 Last Update : None

32.1.6 Status : Analysis

32.1.7 Primary Actor : User(logined)

32.1.8 Preconditions

- 사용자는 매물 상세 페이지에 접근할 수 있어야 하며, DB에서 전세가와 매매가 또는 예측값을 조회할 수 있어야 한다.

  32.1.9 Trigger

- 사용자가 매물 상세 페이지에 진입하거나 '전세가율 보기'를 선택할 때.

  32.1.10 Success Post Conditions

- 전세가율이 계산되어 소수점 둘째 자리로 표시되고, 주변 평균 대비 높음/낮음 여부가 함께 표시된다.

  32.1.11 Failure Post Conditions

- 전세가율 계산 또는 표시가 실패한다.

## 32.2 MAIN SUCCESS SCENARIO

| Step | Action                                                                        |
| ---- | ----------------------------------------------------------------------------- |
| S    | 사용자가 매물 상세 페이지에 진입한다.                                         |
| 1    | 시스템이 DB에서 전세가와 매매가를 조회한다.                                   |
| 2    | 시스템이 전세가/매매가×100을 계산하고 소수점 둘째 자리로 반올림한다.          |
| 3    | 주변 매물 전세가율 평균을 조회하여 비교 결과(높음/낮음)를 산출한다.           |
| 4    | 매매가 데이터가 없으면 AI 예측 매매가를 사용해 "AI 예측 전세가율"로 표시한다. |
| 5    | 계산 결과와 비교 정보를 상세 페이지에 표시한다.                               |

## 32.3 EXTENSION SCENARIOS

| Step | Branching Action                                                                                        |
| ---- | ------------------------------------------------------------------------------------------------------- |
| 2    | 2a. 전세가 또는 매매가 데이터가 없음<br>- 2a1. AI 예측 값을 사용하고, 실패 시 "정보 없음"으로 표시한다. |
| 3    | 3a. 주변 매물 데이터 부족<br>- 3a1. 평균 비교 없이 전세가율만 표시한다.                                 |
| 4    | 4a. 계산 오류 발생<br>- 4a1. 오류 메시지를 표시하고 재시도 버튼을 제공한다.                             |

## 32.4 RELATED INFORMATION

32.4.1 Performance : ≤ 1 second

32.4.2 Frequency

- 제한 없음

  32.4.3 Concurrency : 제한 없음

# Use case 33. 경매 기능

## 33.1 GENERAL CHARACTERISTICS

33.1.1 Summary :  
매물 소유자가 경매를 생성하고, 브로커가 입찰을 제출하며, 소유자가 최종 입찰을 수락하여 경매를 종료하는 전체 흐름을 관리하는 기능

33.1.2 Scope : None

33.1.3 Level : user level

33.1.4 Author : None

33.1.5 Last Update : None

33.1.6 Status : Analysis

33.1.7 Primary Actor :  
- **Primary** : 매물 소유자(User - owner)  
- **Secondary** : 브로커(User - broker)

33.1.8 Preconditions

- 매물 소유자는 자신의 매물 상세 페이지 또는 관리 화면에 접근할 수 있어야 한다.  
- 브로커는 인증된 broker 계정이어야 한다.  
- 매물은 존재해야 하며 조회 권한이 있어야 한다.  
- 기존에 30일 내 진행 중인 경매가 없어야 한다.  
- 매물이 위임 상태가 아니어야 한다.

33.1.9 Trigger

- 소유자가 "경매 생성"을 선택할 때  
- 브로커가 “입찰 제출”을 선택할 때  
- 소유자가 “입찰 수락(경매 종료)”을 선택할 때

33.1.10 Success Post Conditions

- 새로운 경매가 생성되며 상태가 “진행중”으로 설정된다.  
- 브로커의 입찰이 정상적으로 기록되고 최고 금액이 갱신된다.  
- 소유자가 특정 입찰을 선택하면 해당 입찰이 낙찰 처리되고 경매가 종료된다.  
- 종료 시 담당 브로커 자동 지정·거래 조건 생성·참여자 알림 전송 등이 수행된다.

33.1.11 Failure Post Conditions

- 경매 생성/입찰/종료 중 하나라도 검증 실패 시 해당 동작이 무효 처리된다.  
- 권한 부족, 데이터 누락, 조건 불충족 등이 발생하면 오류 메시지가 표시된다.

---

## 33.2 MAIN SUCCESS SCENARIO

| Step | Action |
|------|--------|
| S    | 소유자가 매물 상세 화면에서 경매 생성을 선택한다. |
| 1    | 시스템이 매물 존재 여부·소유자 여부·위임 여부·중복 경매 여부(30일 이내)를 검증한다. |
| 2    | 시스템이 거래 유형·주거 형태·층수 등 입력된 경매 조건을 검증한다. |
| 3    | 조건이 충족되면 새 경매를 생성하고 상태를 ‘IN_PROGRESS(진행중)’로 설정한다. |
| 4    | 브로커가 경매 상세 화면에서 입찰 금액을 입력하고 제출을 요청한다. |
| 5    | 시스템은 경매 상태가 진행중인지 확인하고, 사용자가 브로커 계정인지 확인한다. |
| 6    | 시스템은 제출된 금액이 기존 최고 금액보다 높은지 검증한다. |
| 7    | 유효한 경우 입찰을 저장하고 최고 금액을 갱신한다. |
| 8    | 시스템은 매물 소유자에게 “새로운 입찰 도착” 알림을 전송한다. |
| 9    | 시스템은 직전 최고 입찰자에게 “내 입찰이 상회됨” 알림을 전송한다. |
| 10   | 소유자가 입찰 목록 중 하나를 선택하여 “입찰 수락(경매 종료)”을 누른다. |
| 11   | 시스템이 소유자 권한과 경매 상태(미종료), 이미 낙찰 여부를 검증한다. |
| 12   | 선택된 입찰을 낙찰로 표시하고 경매를 ‘COMPLETED’ 또는 ‘ENDED’로 변경한다. |
| 13   | 담당 브로커 자동 지정·판매 조건 생성·참여자 알림 발송을 수행한다. |
| 14   | 상세 페이지에 경매 종료 및 낙찰 정보를 표시한다. |

---

## 33.3 EXTENSION SCENARIOS

| Step | Branching Action |
|------|------------------|
| 1    | **1a. 매물이 존재하지 않음 또는 접근 권한 없음**<br>- 1a1. 경매 생성 불가 메시지를 표시한다. |
| 1    | **1b. 소유자가 아님**<br>- 1b1. 경매 생성 기능을 허용하지 않는다. |
| 1    | **1c. 매물이 위임된 상태**<br>- 1c1. 새로운 경매 생성이 거부된다. |
| 1    | **1d. 최근 30일 내 진행 중 경매가 있음**<br>- 1d1. 중복 경매 생성 불가 메시지를 표시한다. |
| 4    | **4a. 브로커가 아님**<br>- 4a1. 입찰 제출이 거부된다. |
| 4    | **4b. 경매가 이미 종료됨**<br>- 4b1. 입찰 등록 불가 메시지를 표시한다. |
| 6    | **6a. 제출 금액이 최고가 이하**<br>- 6a1. “입찰 금액이 유효하지 않음” 메시지를 표시한다. |
| 10   | **10a. 소유자가 아님**<br>- 10a1. 경매 종료 기능을 차단한다. |
| 11   | **11a. 이미 종료된 경매**<br>- 11a1. 입찰 수락이 불가하다. |
| 13   | **13a. 알림 전송 실패**<br>- 13a1. 경매는 종료되지만 알림은 재시도 또는 로그만 기록한다. |

---

## 33.4 RELATED INFORMATION

33.4.1 Performance  
- 경매 생성·입찰 제출·입찰 수락은 모두 ≤ 1초 이내 처리

33.4.2 Frequency  
- 제한 없음 (브로커 입찰 횟수도 제한 없음, 검증 통과 시)

33.4.3 Concurrency  
- 여러 브로커가 동시에 입찰 가능  
- 경쟁 상태 발생 시 최고 금액은 DB 레벨에서 원자적으로 업데이트해야 함(낙찰 단일성 보장)
- 

# Use case 34. 매물 비교

## 34.1 GENERAL CHARACTERISTICS

34.1.1 Summary : 사용자가 여러 매물을 비교 그룹으로 묶고 가중치 기반 점수와 순위를 조회하는 기능이다.  
34.1.2 Scope : None  
34.1.3 Level : user level  
34.1.4 Author : None  
34.1.5 Last Update : None  
34.1.6 Status : Analysis  
34.1.7 Primary Actor : User (logined)

34.1.8 Preconditions  
- 사용자가 로그인되어 있어야 한다.  
- 비교 대상 매물이 데이터베이스에 존재해야 한다.  
- `/api/comparisons/**` 엔드포인트는 인증된 사용자만 접근할 수 있다.

34.1.9 Trigger  
- 사용자가 매물 상세 또는 목록 화면에서 “비교하기” 버튼을 클릭한다.  
- 사용자가 비교 그룹을 생성하거나 선택한다.

34.1.10 Success Post Conditions  
- 비교 그룹이 생성 또는 갱신되어 저장된다.  
- 그룹 내 비교 매물 목록이 저장된다.  
- 가중치 설정이 저장된다.  
- 계산된 비교 결과가 사용자에게 반환된다.

34.1.11 Failure Post Conditions  
- 비교 그룹 또는 아이템 저장이 실패한다.  
- 가중치 설정이 실패한다.  
- 비교 계산이 실행되지 않는다.  
- 오류 메시지가 반환된다.

---

## 34.2 MAIN SUCCESS SCENARIO

| Step | Action |
|------|--------|
| S | 사용자가 비교 기능 화면을 연다. |
| 1 | 사용자가 비교 그룹을 생성하거나 선택한다. |
| 2 | 사용자가 매물을 비교 그룹에 추가한다. |
| 3 | 시스템이 중복 매물 여부를 검사한다. |
| 4 | 사용자가 비교 항목의 가중치를 설정한다. |
| 5 | 사용자가 “비교 실행” 버튼을 클릭한다. |
| 6 | 시스템이 JWT 토큰과 그룹 소유자 권한을 검증한다. |
| 7 | 시스템이 비교 대상 매물의 속성을 조회한다. |
| 8 | 시스템이 정규화와 가중치 적용을 통해 점수를 계산한다. |
| 9 | 시스템이 계산된 점수 기준으로 매물을 정렬한다. |
| 10 | 시스템이 점수·순위·요약 정보를 생성한다. |
| 11 | 시스템이 결과를 클라이언트에 반환한다. |
| 12 | 클라이언트가 UI에 결과를 렌더링한다. |

---

## 34.3 EXTENSION SCENARIOS

| Step | Branching Action |
|------|------------------|
| S | **Sa. 로그인하지 않은 사용자이다.**<br>- Sa1. “로그인이 필요합니다.” 메시지를 표시하고 로그인 화면으로 이동한다. |
| 1 | **1a. 그룹 생성 또는 선택 과정에서 권한 오류가 발생했다.**<br>- 1a1. 시스템은 작업을 중단하고 오류 메시지를 표시한다. |
| 2 | **2a. 비교 그룹에 포함된 매물이 1개 이하이다.**<br>- 2a1. 시스템은 “비교는 2개 이상 필요합니다.” 메시지를 표시한다. |
| 3 | **3a. 동일 매물을 다시 추가하려 한다.**<br>- 3a1. 시스템은 “이미 존재하는 매물입니다.” 메시지를 표시한다. |
| 4 | **4a. 사용자가 설정한 가중치의 합이 0이다.**<br>- 4a1. 시스템은 기본 가중치를 자동 설정한다. |
| 5 | **5a. 요청 데이터 형식이 잘못되었다.**<br>- 5a1. 시스템은 “요청 형식 오류” 메시지를 반환한다. |
| 6 | **6a. JWT 토큰이 만료되었거나 유효하지 않다.**<br>- 6a1. 시스템은 401 Unauthorized 응답을 반환한다. |
| 7 | **7a. 일부 매물 속성 정보가 누락되었다.**<br>- 7a1. 시스템은 누락된 필드를 0 또는 중립값으로 처리한다. |
| 8 | **8a. 점수 계산 중 예외가 발생했다.**<br>- 8a1. 시스템은 계산을 중단하고 5xx 오류를 반환한다. |
| 9 | **9a. 정렬 과정에서 데이터 오류가 발생했다.**<br>- 9a1. 기본 순서로 정렬하거나 오류 메시지를 표시한다. |
| 10 | **10a. 결과 생성 중 특정 매물의 필드 오류가 발생했다.**<br>- 10a1. 문제가 있는 매물을 제외하거나 오류를 반환한다. |
| 11 | **11a. 응답 생성 중 서버 오류가 발생했다.**<br>- 11a1. 시스템은 5xx 오류를 반환한다. |
| 12 | **12a. 클라이언트 렌더링 오류가 발생했다.**<br>- 12a1. 클라이언트는 오류 메시지를 표시하고 화면 기본 상태를 유지한다. |

---

## 34.4 RELATED INFORMATION

34.4.1 Performance : ≤ 1 second  
34.4.2 Frequency : 제한 없음  
34.4.3 Concurrency : 제한 없음  
34.4.4 Due Date : None

---

# Use case 35. 실거래가 조회

## 35.1 GENERAL CHARACTERISTICS

35.1.1 Summary : 매물 주소 기반으로 실거래가 이력을 조회하는 기능이다.  
35.1.2 Scope : None  
35.1.3 Level : user level  
35.1.4 Author : None  
35.1.5 Last Update : None  
35.1.6 Status : Analysis  
35.1.7 Primary Actor : User (logined)

35.1.8 Preconditions  
- 매물이 데이터베이스에 존재해야 한다.  
- 실거래 데이터(realestate_deals)가 존재해야 한다.  
- `/api/deals/**` 엔드포인트는 인증이 필요하다.

35.1.9 Trigger  
- 사용자가 실거래 조회를 요청한다.  
- 매물 상세 화면 진입 시 자동 조회가 실행된다.

35.1.10 Success Post Conditions  
- strict/loose 매칭이 적용되며 실거래 목록이 반환된다.

35.1.11 Failure Post Conditions  
- 주소 파싱 실패 시 조회가 불가능하다.  
- 실거래 데이터가 없으면 빈 배열이 반환된다.  
- 서버 오류 시 표준 오류 메시지가 반환된다.

---

## 35.2 MAIN SUCCESS SCENARIO

| Step | Action |
|------|--------|
| S | 사용자가 매물 상세 화면을 연다. |
| 1 | 사용자가 실거래 조회를 요청한다. |
| 2 | 시스템이 JWT를 검증한다. |
| 3 | 시스템이 주소를 파싱하여 city_raw, gu, road_full을 추출한다. |
| 4 | 약칭 도시명을 전체 명칭으로 매핑한다. |
| 5 | strict 매칭을 수행한다. |
| 6 | strict 결과가 없으면 loose 매칭을 수행한다. |
| 7 | 면적 ±10% 조건을 적용한다. |
| 8 | contract_date_int를 계산한다. |
| 9 | 결과를 시간순으로 정렬한다. |
| 10 | DealResponse 목록으로 변환하여 반환한다. |

---

## 35.3 EXTENSION SCENARIOS

| Step | Branching Action |
|------|------------------|
| 1 | **1a. 조회 요청 데이터가 누락되었다.**<br>- 1a1. 시스템은 오류 메시지를 반환한다. |
| 2 | **2a. JWT 토큰이 유효하지 않다.**<br>- 2a1. 시스템은 401 Unauthorized 응답을 반환한다. |
| 3 | **3a. 주소 파싱에 실패했다.**<br>- 3a1. 빈 배열을 반환한다. |
| 5 | **5a. strict 매칭 결과가 없다.**<br>- 5a1. loose 매칭을 수행한다. |
| 7 | **7a. 면적 정보가 없다.**<br>- 7a1. 면적 필터를 제외하고 조회한다. |
| 8 | **8a. 날짜 변환 중 오류가 발생했다.**<br>- 8a1. 해당 레코드를 제외하거나 조회를 중단한다. |
| 9 | **9a. 정렬 중 오류가 발생했다.**<br>- 9a1. 시스템은 기본 순서로 반환한다. |
| 10 | **10a. DealResponse 변환 중 오류가 발생했다.**<br>- 10a1. 시스템은 오류 메시지를 반환한다. |
| * | **\*a. 기타 예외가 발생했다.**<br>- \*a1. 시스템은 5xx 오류를 반환한다. |

---

## 35.4 RELATED INFORMATION

35.4.1 Performance : ≤ 500ms  
35.4.2 Frequency : 상세 화면 로딩 시 1회  
35.4.3 Concurrency : 제한 없음  
35.4.4 Due Date : None

---

# Use case 36. 이상 매물 탐지

## 36.1 GENERAL CHARACTERISTICS

36.1.1 Summary : 실거래 평균 대비 매물 가격의 이상 여부를 자동 판정하는 기능이다.  
36.1.2 Scope : None  
36.1.3 Level : system level  
36.1.4 Author : None  
36.1.5 Last Update : None  
36.1.6 Status : Implemented  
36.1.7 Primary Actor : System (Trigger)

36.1.8 Preconditions  
- properties 테이블에 INSERT 또는 UPDATE가 발생해야 한다.  
- realestate_deals 데이터가 존재해야 한다.  
- 이상 탐지 트리거가 활성화되어 있어야 한다.

36.1.9 Trigger  
- 매물 입력 또는 수정 시 트리거 함수가 실행된다.

36.1.10 Success Post Conditions  
- NEW.anomaly_alert 값이 true, false, null 중 하나로 설정된다.

36.1.11 Failure Post Conditions  
- 주소 파싱 실패 시 null로 설정된다.  
- 실거래가 존재하지 않으면 null이 설정된다.  
- 트리거 오류 발생 시 트랜잭션에 영향을 줄 수 있다.

---

## 36.2 MAIN SUCCESS SCENARIO

| Step | Action |
|------|--------|
| S | 매물 INSERT 또는 UPDATE가 발생한다. |
| 1 | 시스템이 price 또는 address가 null인지 검증한다. |
| 2 | null이면 anomaly_alert를 null로 설정한다. |
| 3 | 시스템이 주소를 정규화하고 city_raw, gu, road_full을 추출한다. |
| 4 | 약칭 도시명을 전체 명칭으로 매핑한다. |
| 5 | strict 기준으로 실거래 후보를 조회한다. |
| 6 | strict 결과가 없으면 loose 매칭으로 조회한다. |
| 7 | 면적 조건(±10%)을 적용한다. |
| 8 | 실거래 평균가를 계산한다. |
| 9 | 매물 가격을 10,000원 단위로 환산한다. |
| 10 | 편차 비율을 계산한다. |
| 11 | 편차가 30% 초과하면 anomaly_alert를 true로 설정한다. |
| 12 | 그 이하면 false로 설정한다. |
| 13 | NEW 레코드를 반환한다. |

---

## 36.3 EXTENSION SCENARIOS

| Step | Branching Action |
|------|------------------|
| 1 | **1a. price 또는 address가 null이다.**<br>- 1a1. anomaly_alert를 null로 설정하고 트리거를 종료한다. |
| 5 | **5a. strict 기준 결과가 존재하지 않는다.**<br>- 5a1. loose 기준으로 조회한다. |
| 8 | **8a. 실거래 평균가가 null이다.**<br>- 8a1. anomaly_alert를 null로 설정한다. |
| 10 | **10a. 편차 계산 중 0으로 나누기 오류가 발생했다.**<br>- 10a1. anomaly_alert를 null로 설정한다. |
| * | **\*a. 기타 예외가 발생했다.**<br>- \*a1. 트랜잭션 정책에 따라 롤백하거나 예외를 반환한다. |

---

## 36.4 RELATED INFORMATION

36.4.1 Performance : Trigger는 100ms 내외로 작동해야 한다.  
36.4.2 Frequency : 매물 생성 또는 수정 시마다 실행된다.  
36.4.3 Concurrency : 다중 입력 상황에서도 안정적으로 동작해야 한다.  
36.4.4 Due Date : None
