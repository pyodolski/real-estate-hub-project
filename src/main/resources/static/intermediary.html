<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>중개인 관리 페이지</title>
    <!-- Token Validator - 페이지 로드 시 토큰 유효성 검증 -->
    <script src="/js/utils/token-validator.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- JavaScript 파일 (ES6 Module) -->
    <script src="/js/utils/auth-utils.js"></script>
    <script type="module" src="/js/broker/main/intermediary-main.js"></script>
    <script
      src="/js/broker/delegation/broker-delegation-management.js"
      defer
    ></script>
    <!-- 위임 요청 상세 패널 -->
    <script src="/js/broker/delegation/delegation-detail-overlay.js"></script>
    <script src="/js/broker/delegation/delegation-detail-panel.js"></script>
    <link rel="stylesheet" href="./css/map.css" />
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=madicr2e0g&submodules=coord,geocoder"></script>
    <!-- Google Fonts (Inter & Noto Sans KR) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Custom Styles */
      body {
        font-family: "Inter", "Noto Sans KR", sans-serif;
      }
      /* Custom scrollbar for better aesthetics */
      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }
    </style>
  </head>
  <body class="bg-gray-100 h-screen overflow-hidden">
    <div class="relative w-full h-full">
      <!-- =================================================================== -->
      <!-- 메인 대시보드 영역                                               -->
      <!-- =================================================================== -->
      <main class="w-full h-full">
        <!-- 대시보드 콘텐츠 (기존 지도 영역 대체) -->
        <div
          class="absolute inset-0 bg-gray-200 flex items-center justify-center"
        >
          <p class="text-gray-500 text-3xl font-bold">[ 지도 영역 ]</p>
        </div>

        <!-- 상단 검색 및 필터 바 (롤백된 버전) -->
        <div
          id="search-bar-container"
          class="absolute top-6 flex flex-row flex-wrap items-center gap-3 z-10 transition-all duration-300 ease-in-out"
          style="left: 474px; right: 99px"
        >
          <!-- Search Bar -->
          <div
            class="flex items-center bg-white rounded-full shadow-lg px-4 py-2 flex-shrink-0"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-gray-400 mr-3 flex-shrink-0"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
              type="text"
              placeholder="동, 지하철역, 대학교, 매물번호"
              class="w-56 focus:outline-none bg-transparent text-sm"
            />
          </div>

          <!-- Filter Buttons -->
          <div class="bg-white rounded-full shadow-lg">
            <button
              class="px-4 py-3 text-gray-700 text-sm font-medium hover:bg-gray-100 rounded-full"
            >
              주거형태
            </button>
          </div>
          <div class="bg-white rounded-full shadow-lg">
            <button
              class="px-4 py-3 text-gray-700 text-sm font-medium hover:bg-gray-100 rounded-full"
            >
              거래방식
            </button>
          </div>
          <div class="bg-white rounded-full shadow-lg">
            <button
              class="px-4 py-3 text-gray-700 text-sm font-medium hover:bg-gray-100 rounded-full"
            >
              전용면적
            </button>
          </div>
          <div class="bg-white rounded-full shadow-lg">
            <button
              class="px-4 py-3 text-gray-700 text-sm font-medium hover:bg-gray-100 rounded-full"
            >
              층수
            </button>
          </div>
          <div class="bg-white rounded-full shadow-lg">
            <button
              class="px-4 py-3 text-gray-700 text-sm font-medium hover:bg-gray-100 rounded-full"
            >
              옵션
            </button>
          </div>
          <div class="bg-white rounded-full shadow-lg">
            <button
              class="px-5 py-3 text-gray-700 font-semibold text-sm flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6-6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                />
              </svg>
              전체필터
            </button>
          </div>
           </div>
      </main>

      <!-- =================================================================== -->
      <!-- 왼쪽 매물 관리 패널                                                  -->
      <!-- =================================================================== -->
      <aside
        id="side-panel"
        class="absolute top-0 left-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform transition-all duration-300 ease-in-out"
      >
        <!-- 전체화면에서 돌아오는 버튼 -->
        <button
          id="collapse-fullscreen-button"
          class="absolute top-6 right-6 p-2 rounded-full hover:bg-gray-200 transition-colors hidden z-50"
          title="패널 축소"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-gray-700"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
            ></path>
          </svg>
        </button>
        <!-- 상단 메뉴 -->
        <div
          class="flex justify-between items-center mb-6 pb-4 border-b flex-shrink-0"
        >
          <a href="#" class="text-2xl font-bold text-indigo-600">부동산 로고</a>
          <div
            id="add-listing-container"
            class="flex items-center gap-2 transition-all duration-300 ease-in-out"
          >
            <button
              class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-md text-sm hover:bg-indigo-700 transition-colors flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                  clip-rule="evenodd"
                />
              </svg>
              새 매물 등록
            </button>
          </div>
        </div>

        <!-- 스크롤 가능한 콘텐츠 영역 -->
        <div class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2">
          <!-- 매물 등록 알림 섹션 -->
          <div>
            <h2
              class="text-lg font-semibold text-gray-700 mb-3 flex items-center"
            >
              새로운 등록 요청
              <span
                class="ml-2 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full"
                >3</span
              >
            </h2>
            <div id="registration-requests" class="flex flex-col space-y-4">
              <!-- JavaScript로 등록 요청 아이템이 여기에 추가됩니다. -->
            </div>
          </div>

          <!-- 구분선 -->
          <div class="border-t my-6"></div>

          <!-- 내 매물 목록 섹션 -->
          <div>
            <h2 class="text-lg font-semibold text-gray-700 mb-3">
              관리중인 매물 목록
            </h2>
            <div id="agent-property-list" class="flex flex-col space-y-4">
              <!-- JavaScript로 관리 매물 아이템이 여기에 추가됩니다. -->
            </div>
          </div>
        </div>
      </aside>

      <!-- 패널 열기 버튼 -->
      <button
        id="open-panel-button"
        class="absolute top-1/2 -translate-y-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-r-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out opacity-0 pointer-events-none"
        style="left: 0px"
        title="패널 열기"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-gray-600"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>

      <!-- 패널 닫기 버튼 -->
      <button
        id="close-panel-button"
        class="absolute top-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-r-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out"
        style="left: 450px; transform: translateY(calc(-50% + 2.5rem))"
        title="패널 닫기"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-gray-600"
        >
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <!-- 패널 확장 버튼 -->
      <button
        id="expand-panel-button"
        class="absolute top-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-r-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out"
        style="left: 450px; transform: translateY(calc(-50% - 2.5rem))"
        title="패널 확장"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 text-gray-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13 5l7 7-7 7M5 5l7 7-7 7"
          ></path>
        </svg>
      </button>

      <!-- =================================================================== -->
      <!-- 오른쪽 상세 정보 패널 (롤백된 버전)                                  -->
      <!-- =================================================================== -->
      <aside
        id="right-side-panel"
        class="absolute top-0 right-0 w-[75px] bg-white pt-4 px-2 pb-2 flex flex-col justify-between h-full shadow-lg z-[60] transition-transform duration-300 ease-in-out"
      >
        <div class="flex flex-col items-center space-y-2">
          <!-- 상단 아이콘 버튼들 -->
          <button
            class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m0 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3a1 1 0 001-1V10m-9-10"
              />
            </svg>
          </button>
          <button
            class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
              />
            </svg>
          </button>
          <!--
          <button
            class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
          </button>
          -->
          <!-- 위임 요청함 버튼 -->
          <button
            id="delegation-request-button"
            class="w-full aspect-square bg-gray-100 hover:bg-gray-200 transition-all rounded-2xl p-2 flex items-center justify-center"
            title="위임 요청 관리"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                  d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
              />
            </svg>
          </button>
        </div>
        <button
          id="logout-button"
          class="w-full aspect-square bg-[#FF3737] hover:brightness-95 transition-all rounded-2xl p-2 flex items-center justify-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-gray-700"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2.5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M5.636 5.636a9 9 0 1012.728 0M12 3v9"
            />
          </svg>
        </button>
      </aside>

      <!-- 오른쪽 패널 토글 버튼 (롤백된 버전) -->
      <button
        id="right-panel-toggle-button"
        class="absolute top-1/2 -translate-y-1/2 w-8 h-16 bg-white/90 shadow-lg rounded-l-lg flex items-center justify-center z-30 transition-all duration-300 ease-in-out"
        style="right: 75px"
      >
        <svg
          id="right-open-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="hidden"
        >
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <svg
          id="right-close-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <!-- =================================================================== -->
    <!-- 위임 요청 관리 패널                                                   -->
    <!-- =================================================================== -->
    <aside
      id="delegation-request-panel"
      class="absolute top-0 w-[450px] bg-white p-6 flex flex-col h-full shadow-lg z-20 transform translate-x-full transition-transform duration-300 ease-in-out"
      style="right: 75px; display: none"
    >
      <!-- 위임 요청 관리 패널 헤더 -->
      <div
        class="flex justify-between items-center mb-4 pb-4 border-b flex-shrink-0"
      >
        <h2 class="text-xl font-bold text-gray-800">위임 요청 관리</h2>
        <button
          id="close-delegation-panel"
          class="p-2 rounded-full hover:bg-gray-200 transition-colors"
          title="위임 요청 패널 닫기"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-gray-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>

      <!-- 필터 탭 -->
      <div class="mb-4 flex-shrink-0">
        <div class="flex border-b border-gray-200">
          <button
            id="pending-tab"
            class="flex-1 px-4 py-2 text-center border-b-2 border-blue-500 text-blue-600 font-medium"
            onclick="brokerDelegation.filterByStatus('PENDING')"
          >
            대기 중
          </button>
          <button
            id="approved-tab"
            class="flex-1 px-4 py-2 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700"
            onclick="brokerDelegation.filterByStatus('APPROVED')"
          >
            승인됨
          </button>
          <button
            id="rejected-tab"
            class="flex-1 px-4 py-2 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700"
            onclick="brokerDelegation.filterByStatus('REJECTED')"
          >
            거절됨
          </button>
          <button
            id="all-tab"
            class="flex-1 px-4 py-2 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700"
            onclick="brokerDelegation.filterByStatus('ALL')"
          >
            전체
          </button>
        </div>
      </div>

      <!-- 요청 통계 -->
      <div class="mb-4 flex-shrink-0">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="grid grid-cols-3 gap-4 text-center">
            <div>
              <div id="pending-count" class="text-lg font-bold text-orange-600">
                0
              </div>
              <div class="text-xs text-gray-600">대기 중</div>
            </div>
            <div>
              <div id="approved-count" class="text-lg font-bold text-green-600">
                0
              </div>
              <div class="text-xs text-gray-600">승인됨</div>
            </div>
            <div>
              <div id="rejected-count" class="text-lg font-bold text-red-600">
                0
              </div>
              <div class="text-xs text-gray-600">거절됨</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 스크롤 가능한 요청 목록 영역 -->
      <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 -mr-2">
        <div id="delegation-request-list" class="space-y-4">
          <!-- JavaScript로 위임 요청 목록이 여기에 추가됩니다 -->
        </div>
      </div>
    </aside>

    <!-- 위임 요청 상세 패널 삽입 스크립트 -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (typeof DelegationDetailOverlay !== 'undefined') {
          const container = document.querySelector('.relative.w-full.h-full');
          if (container) {
            container.insertAdjacentHTML('beforeend', DelegationDetailOverlay.render());
          }
        }
      });
    </script>
    <script src="js/regular/main/map-filter-panel.js"></script>

    <!-- 채팅 기능 스크립트 -->
    <script type="module" src="js/regular/main/chat-panel.js"></script>
    <script type="module" src="js/regular/main/chat-controller.js"></script>

    <!-- 위임 요청 관리 스크립트 -->
    <script src="js/broker/delegation/broker-delegation-management.js"></script>
  </body>
</html>
